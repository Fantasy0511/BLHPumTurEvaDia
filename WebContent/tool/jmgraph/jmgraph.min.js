function jmGradient(e){if(e)for(var t in e)this[t]=e[t];this.stops=new jmUtils.list}function jmShadow(e,t,n,r){this.x=e,this.y=t,this.blur=n,this.color=r,this.toGlow=function(){return{width:this.blur,offsetx:this.x,offsety:this.y,color:this.color}}}function jmObject(){}function jmEvents(e,t){function n(e,t){this.container=e,this.target=t||e,this.init=function(){var t=this.target;t.oncontextmenu=function(){return!1},jmUtils.bindEvent(this.target,"mousedown",function(t){t=t||event;var n=e.raiseEvent("mousedown",t);return t.preventDefault&&t.preventDefault(),!1}),jmUtils.bindEvent(window.document,"touchstart",function(t){return t=t||event,e.raiseEvent("touchstart",t),t.preventDefault&&t.preventDefault(),!1}),jmUtils.bindEvent(window.document,"mousemove",function(n){n=n||event;var r=n.target||n.srcElement;if(r==t){var i=e.raiseEvent("mousemove",n);return n.preventDefault&&n.preventDefault(),!1}}),jmUtils.bindEvent(window.document,"touchmove",function(t){return t=t||event,e.raiseEvent("touchmove",t),t.preventDefault&&t.preventDefault(),!1}),jmUtils.bindEvent(this.target,"mouseover",function(t){t=t||event,e.raiseEvent("mouseover",t)}),jmUtils.bindEvent(this.target,"mouseleave",function(t){t=t||event,e.raiseEvent("mouseleave",t)}),jmUtils.bindEvent(this.target,"mouseout",function(t){t=t||event,e.raiseEvent("mouseout",t)}),jmUtils.bindEvent(window.document,"mouseup",function(t){t=t||event;var n=e.raiseEvent("mouseup",t);if(n===!1)return t.preventDefault&&t.preventDefault(),!1}),jmUtils.bindEvent(window.document,"touchend",function(t){return t=t||event,e.raiseEvent("touchend",t),t.preventDefault&&t.preventDefault(),!1}),jmUtils.bindEvent(this.target,"dblclick",function(t){t=t||event,e.raiseEvent("dblclick",t)}),jmUtils.bindEvent(this.target,"click",function(t){t=t||event,e.raiseEvent("click",t)}),jmUtils.bindEvent(document,"resize",function(t){return t=t||event,e.raiseEvent("resize",t)})},this.init()}function r(e,t){function n(e){var t=e.srcElement||e.target;return!t||t.tagName!="INPUT"&&t.tagName!="TEXTAREA"&&t.tagName!="ANCHOR"&&t.tagName!="FORM"&&t.tagName!="FILE"&&t.tagName!="IMG"&&t.tagName!="HIDDEN"&&t.tagName!="RADIO"&&t.tagName!="TEXT"?!0:!1}this.container=e,this.target=t||e,this.init=function(){jmUtils.bindEvent(document,"keypress",function(t){t=t||event;if(!n(t))return;var r=e.raiseEvent("keypress",t);return r===!1&&t.preventDefault&&t.preventDefault(),r}),jmUtils.bindEvent(document,"keydown",function(t){t=t||event;if(!n(t))return;var r=e.raiseEvent("keydown",t);return r===!1&&t.preventDefault&&t.preventDefault(),r}),jmUtils.bindEvent(document,"keyup",function(t){t=t||event;if(!n(t))return;var r=e.raiseEvent("keyup",t);return r===!1&&t.preventDefault&&t.preventDefault(),r})},this.init()}this.mouseHandler=new n(e,t),this.keyHandler=new r(e,t)}function jmControl(){}function runEventHandle(e,t){var n=this.getEvent(e);if(n){var r=this;n.each(function(e,n){!1===n.call(r,t)&&(t.cancel=!0)})}return t.cancel}function jmShape(e){this.type="jmShape",this.graph=e,this.initializing(e.context,style)}function jmPath(e,t){this.type="jmPath";var n=t&&t.style?t.style:null;this.graph=e,this.points=t&&t.points?t.points:[],this.initializing(e.context,n)}function jmLine(e,t){t||(t={}),this.type="jmLine",this.points=t.points||[];var n=t.style||{};this.graph=e,this.start(t.start||{x:0,y:0}),this.end(t.end||{x:0,y:0}),n.lineType=n.lineType||"solid",n.dashLength=n.dashLength||4,this.initializing(e.context,n)}function jmCircle(e,t){t||(t={}),this.type="jmCircle",this.points=t.points||[];var n=t.style||{};this.graph=e,this.center(t.center||{x:0,y:0}),this.width(t.width||0),this.height(t.height||0),this.radius(t.radius||0),this.initializing(e.context,n)}function jmArc(e,t){t||(t={}),this.points=t.points||[];var n=t.style||{};this.type="jmArc",this.graph=e,this.center(t.center||{x:0,y:0}),this.radius(t.radius||0),this.startAngle(t.start||0),this.endAngle(t.end||Math.PI*2),this.width(t.width||0),this.height(t.height||0),this.anticlockwise(t.anticlockwise||0),this.initializing(e.context,n)}function jmHArc(e,t){t||(t={}),this.type="jmHArc",this.points=t.points||[];var n=t.style||{};this.graph=e,this.center(t.center||{x:0,y:0}),this.minRadius(t.minRadius||n.minRadius||0),this.maxRadius(t.maxRadius||n.maxRadius||0),this.startAngle(t.start||0),this.endAngle(t.end||Math.PI*2),this.width(t.width||0),this.height(t.height||0),this.anticlockwise(t.anticlockwise||0),this.initializing(e.context,n)}function jmPrismatic(e,t){t||(t={}),this.type="jmPrismatic",this.points=t.points||[];var n=t.style||{};this.graph=e,this.center(t.center||{x:0,y:0}),this.width(t.width||0),this.height(t.height||0),this.initializing(e.context,n)}function jmBezier(e,t){t||(t={}),this.type="jmBezier",this.points=t.points||[];var n=t.style||{};this.graph=e,this.cpoints(this.points),this.initializing(e.context,n)}function jmRect(e,t){t||(t={}),this.type="jmRect",this.points=t.points||[];var n=t.style||{};n.close=!0,this.graph=e,this.position(t.position||{x:0,y:0}),this.width(t.width||0),this.height(t.height||0),this.radius(t.radius||n.radius||0),this.initializing(e.context,n)}function jmArraw(e,t){t||(t={}),this.points=t.points||[];var n=t.style||{};this.type="jmArraw",n.lineJoin="miter",n.lineCap="square",this.graph=e,this.angle(t.angle||0),this.start(t.start||0),this.end(t.end||0),this.offsetX(t.offsetX||5),this.offsetY(t.offsetY||8),this.initializing(e.context,n)}function jmLabel(e,t){t||(t={});var n=t.style||{};n.font=n.font||"15px Arial",this.type="jmLabel",n.textAlign=n.textAlign||"left",n.textBaseline=n.textBaseline||"middle",this.graph=e,this.value=t.value,this.position(t.position||{x:0,y:0}),this.width(t.width||0),this.height(t.height||0),e.mode!="canvas"&&(this.svgShape=e.context.create("text",this)),this.initializing(e.context,n)}function jmImage(e,t){var n=t&&t.style?t.style:{};this.graph=e,this.width(t.width),this.height(t.height),this.type="jmImage",this.position(t.position||{x:0,y:0}),this.sourceWidth(t.swidth),this.sourceHeight(t.sheight),this.sourcePosition(t.sposition),this.image(t.image||n.image),this.initializing(e.context,n)}function jmResize(e,t){this.params=t||{};var n=t.style||{};this.type="jmResize",this.enabled=t.enabled===!1?!1:!0,this.graph=e,this.points=t.points||[],this.position(t.position||{x:0,y:0}),this.width(t.width||0),this.height(t.height||0),this.rectSize(t.rectSize||10),this.initializing(e.context,n),this.init()}function jmArrawLine(e,t){t||(t={}),this.points=t.points||[];var n=t.style||{};n.lineJoin="miter",this.graph=e,this.type="jmArrawLine",this.start=t.start||(t.start={x:0,y:0}),this.end=t.end||(t.end={x:0,y:0}),this.initializing(e.context,n),this.line=e.createShape("line",t),this.arraw=e.createShape("arraw",t)}function jmTooltip(e,t){t||(t={});var n=t.style||{};n.font=n.font||"15px Arial",this.type="jmTooltip",this.graph=e,this.position(t.position||{x:0,y:0}),this.initializing(e.context,n),this.element=document.createElement("div"),this.element.className="jm-tooltip",this.element.style.position="absolute",this.element.style.display="none",this.value(t.value),document.body.appendChild(this.element)}function jmGraph(e,t,n){this.type="jmGraph",this.mode="canvas",typeof e=="string"&&(e=document.getElementById(e));if(this.mode=="canvas"){if(e.tagName!="CANVAS"){var r=document.createElement("canvas");e.appendChild(r),r.width=e.clientWidth,r.height=e.clientHeight,e=r}this.canvas=e,t&&this.width(t),n&&this.height(n),typeof G_vmlCanvasManager!="undefined"&&G_vmlCanvasManager.init_(document),this.context=e.getContext("2d")}else this.context=new jmSVG(e,t,n),this.canvas=this.context.paper;this.initializing(this.context),function(){typeof jmLine!="undefined"&&this.registerShape("line",jmLine),typeof jmPath!="undefined"&&this.registerShape("path",jmPath),typeof jmRect!="undefined"&&this.registerShape("rect",jmRect),typeof jmCircle!="undefined"&&this.registerShape("circle",jmCircle),typeof jmArc!="undefined"&&this.registerShape("arc",jmArc),typeof jmHArc!="undefined"&&this.registerShape("harc",jmHArc),typeof jmPrismatic!="undefined"&&this.registerShape("prismatic",jmPrismatic),typeof jmLabel!="undefined"&&this.registerShape("label",jmLabel),typeof jmImage!="undefined"&&(this.registerShape("image",jmImage),this.registerShape("img",jmImage)),typeof jmBezier!="undefined"&&this.registerShape("bezier",jmBezier),typeof jmArraw!="undefined"&&this.registerShape("arraw",jmArraw),typeof jmArrawLine!="undefined"&&this.registerShape("arrawline",jmArrawLine),typeof jmResize!="undefined"&&this.registerShape("resize",jmResize),typeof jmTooltip!="undefined"&&this.registerShape("tooltip",jmTooltip)}.call(this),this.eventHandler=new jmEvents(this,this.canvas.canvas||this.canvas)}function jmCell(e){this.option=e,this.type="jmCell",this.value(e.value||""),this.graph=e.graph,this.editor=e.editor,this.styleName=e.style,this.setStyle(this.styleName),e.position=e.position||{x:0,y:0},e.width?this.width(e.width):this.style.width&&(this.width(this.style.width),e.position.x-=this.style.width/2),e.height?this.height(e.height):this.style.height&&(this.height(this.style.height),e.position.y-=this.style.height/2),this.position(e.position),this.selected=!1,this.initializing(this.graph.context,this.style),typeof e.resizable!="undefined"?this.resizable=e.resizable:typeof this.style.resizable!="undefined"&&(this.resizable=this.style.resizable),typeof e.connectable!="undefined"?this.connectable=e.connectable:typeof this.style.connectable!="undefined"?this.connectable=this.style.connectable:this.connectable=this.editor.connectable}function jmConnectLine(e,t){this.graph=e,this.editor=t.editor,this.id=t.id,this.from=t.from,this.to=t.to,this.selected=!1,this.points=t.points||[];var n=t.style||{stroke:this.editor.defaultStyle.connectLine.stroke,lineWidth:this.editor.defaultStyle.connectLine.lineWidth,zIndex:1};this.type="jmConnectLine",n.close=!1,this.initializing(e.context,n),t=jmUtils.extend({start:t.from.outPos2,end:t.to.inPos},t);var r=jmUtils.clone(t.style);r.fill=n.stroke,t.style=r,this.arraw=e.createShape("arraw",t),this.children.add(this.arraw);var i=this.style.fontStyle||this.editor.defaultStyle.font;this.label=this.graph.createShape("label",{style:i}),this.on("add",function(e){e.children.add(e.label)}),this.on("beginDraw",function(e){var t=e.bounds;e.label.width(t.width),e.label.height(t.height)}),this.selected=!1}function jmEditor(e){this.option=e,this.cells=new jmUtils.list,this.connects=new jmUtils.list,this.styles={},this.type="jmEditor",typeof e.enabled=="undefined"&&(e.enabled=!0),this.isEnabled(e.enabled),this.connectable=e.connectable===!1?!1:!0,this.movable=e.movable===!1?!1:!0,e.container&&(typeof e.container=="string"&&(e.container=document.getElementById(e.container)),e.container.tagName!="CANVAS"?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.style.padding="0",this.container.style.margin="0",this.container.style.width="100%",this.container.style.height="100%",e.container.appendChild(this.container)):(this.container=e.container.parentElement,canvas=e.container),this.graph=new jmGraph(this.container,e.width,e.height),this.selectRect=this.graph.createShape("rect",{style:this.defaultStyle.selectRect}),this.selectRect.visible=!1,this.graph.children.add(this.selectRect),this.graph.registerShape("cellConnectLine",jmConnectLine),this.initEvents())}var jmUtils={version:"1.0.0"};jmUtils.extend=function(e,t){if(typeof t=="function"){var n=function(){};n.prototype=t.prototype;var r=e.prototype;r&&r.constructor!=Object&&jmUtils.extend(n,r),e.prototype=new n,e.prototype.constructor=e,e.superClass=t}else{if(typeof t!="object")throw new Error('fatal error:"Function.prototype.extend" expects a function or object');var i=typeof e=="function"?e.prototype:e;for(var s in t)i[s]||(i[s]=t[s]);i._base=t}return e},jmUtils.clone=function(e){if(e&&typeof e=="object"){if(jmUtils.isType(e,jmUtils.list))return new jmUtils.list(e.items);if(jmUtils.isArray(e))return e.slice(0);var t={};t.constructor=e.constructor;for(var n in e)t[n]=jmUtils.clone(e[n]);return t}return e},jmUtils.apply=function(e,t){if(typeof e=="object"&&typeof t=="object")for(var n in e){var r=typeof e[n];if(r=="function")continue;if(r=="object"){if(!t[n]||typeof t[n]!="object")t[n]={};this.apply(e[n],t[n])}else t[n]=e[n]}},jmUtils.list=function(){function e(e){this.items=[],e&&(jmUtils.isArray(e)?this.items=e.slice(0):this.items.push(e))}return e.prototype.add=function(e){if(e&&jmUtils.isArray(e)){for(var t in e)this.add(e[t]);return e}return typeof e=="object"&&this.contain(e)?e:(this.items.push(e),e)},e.prototype.remove=function(e){for(var t=this.items.length-1;t>=0;t--)this.items[t]==e&&this.removeAt(t)},e.prototype.removeAt=function(e){this.items.length>e&&this.items.splice(e,1)},e.prototype.contain=function(e){for(var t in this.items)if(this.items[t]==e)return!0;return!1},e.prototype.get=function(e){if(typeof e!="function")return this.items[e];for(var t in this.items)if(e(this.items[t]))return this.items[t]},e.prototype.each=function(e,t){if(e&&typeof e=="function")if(t)for(var n=this.items.length-1;n>=0;n--){var r=e.call(this,n,this.items[n]);if(r===!1)break}else{var i=this.items.length;for(var n=0;n<i;n++){var r=e.call(this,n,this.items[n]);if(r===!1)break}}},e.prototype.sort=function(e){this.items.sort(e)},e.prototype.count=function(e){if(e&&typeof e=="function"){var t=0,n=this.items.length;for(var r=0;r<n;r++)e(this.items[r])&&t++;return t}return this.items.length},e.prototype.clear=function(){for(var e=this.items.length-1;e>=0;e--)this.remove(this.items[e])},e}(),jmUtils.cache={items:{},add:function(e,t){return this.set(e,t),t},set:function(e,t){this.items[e]=t},get:function(e){return this.items[e]},remove:function(e){this.items[e]=null}},jmUtils.browser=function(){if(jmUtils.browserInfo)return jmUtils.browserInfo;jmUtils.browserInfo={agent:navigator.userAgent},/Mobile/i.test(jmUtils.browserInfo.agent)&&(jmUtils.browserInfo.mobile=!0),/iPad/i.test(jmUtils.browserInfo.agent)?jmUtils.browserInfo.iPad=!0:/iPhone/i.test(jmUtils.browserInfo.agent)?jmUtils.browserInfo.iPhone=!0:/Android/i.test(jmUtils.browserInfo.agent)&&(jmUtils.browserInfo.android=!0);if(/msie/i.test(jmUtils.browserInfo.agent)){jmUtils.browserInfo.msie=!0;var e=jmUtils.browserInfo.agent.match(/msie\s+\d+(\.\d+)*/i)[0];jmUtils.browserInfo.ver=e.match(/\d+(\.\d+)*/)[0]}else/Chrome/i.test(jmUtils.browserInfo.agent)?jmUtils.browserInfo.chrome=!0:/Safari/i.test(jmUtils.browserInfo.agent)?jmUtils.browserInfo.safari=!0:/Firefox/i.test(jmUtils.browserInfo.agent)&&(jmUtils.browserInfo.firefox=!0);return jmUtils.browserInfo},jmUtils.isSupportedBrowser=function(){var e=jmUtils.browser();return!e.msie||e.ver>8},jmUtils.checkSupportedMode=function(){var e=document.createElement("canvas");if(e&&e.getContext)return"canvas";if(document.createElementNS)return"svg";if(this.browser().msie&&this.browser().ver<9)return"vml";throw"not supported browser"},jmUtils.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"},jmUtils.isDate=function(e){return Object.prototype.toString.call(e)==="[object Date]"},jmUtils.loadImg=function(e,t){if(jmUtils.isArray(e)||typeof e=="object"){var n=0,r=0;for(var i in e)n++,t?jmUtils.loadImg(e[i],function(){r++,r==n&&t()}):jmUtils.loadImg(e[i])}else if(typeof e=="string"){var s=document.createElement("img");t&&(s.onload=function(){t()},s.onerror=function(){t()}),s.src=e}else t()},jmUtils.require=function(e,t){if(jmUtils.isArray(e)){var n=e.length;for(var r in e)jmUtils.require(e[r],function(e,r){r?t&&t(e,r):(n--,n==0&&t&&t(n))})}else{var i=document.getElementsByTagName("script");for(var r in i)if(i[r].src===e){t&&t(e);return}i=document.createElement("script"),i.type="text/javascript",i.charset="utf-8",i.src=e;var s=document.getElementsByTagName("head")[0];s.appendChild(i);if(t){function o(n){if(this.readyState&&this.readyState!=="loaded"&&this.readyState!=="complete")return;t&&t(e)}i.readyState?i.onreadystatechange=o:i.onload=o}i.onerror=function(){s.removeChild(i),t&&t(e,"load faild")}}},jmUtils.bindEvent=function(e,t,n){return e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener?(e.addEventListener(t,n),!0):!1},jmUtils.removeEvent=function(e,t,n){if(e.removeEventListener)return e.removeEventListener(t,n,!1);if(e.detachEvent)return e.detachEvent("on"+t,n),!0;e["on"+t]=null},jmUtils.getElementPosition=function(e){if(!e)return;var t={top:0,left:0};if(e.offsetParent)while(e.offsetParent)t.top+=e.offsetTop,t.left+=e.offsetLeft,e=e.offsetParent;else e.x?t.left+=e.x:e.x&&(t.top+=e.y);return t},jmUtils.getEventPosition=function(e,t){e=e||event;var n=e.changedTouches||e.targetTouches||e.touches;n&&(e=n[0]);var r=e.pageX||e.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft),i=e.pageY||e.clientY+(document.documentElement.scrollTop||document.body.scrollTop),s=e.offsetX,o=e.offsetY;if(typeof s=="undefined"&&typeof o=="undefined"){var u=jmUtils.getElementPosition(e.target||e.srcElement);s=r-u.left,o=i-u.top}return t&&(t.x&&(s/=t.x),t.y&&(o/=t.y)),{pageX:r,pageY:i,clientX:e.clientX,clientY:e.clientY,offsetX:s,offsetY:o,layerX:e.layerX,layerY:e.layerY,screenX:e.screenX,screenY:e.screenY,x:s,y:o}},jmUtils.isType=function(e,t){return!e||typeof e!="object"?!1:e.constructor===t?!0:!1},jmUtils.pointInPolygon=function(e,t,n){n=n||1,n/=2;var r,i,s=t.length,o=!1,u=!0;if(!t||s==0)return 0;if(s==1)return Math.abs(t[0].x-e.x)<=n&&Math.abs(t[0].y-e.y)<=n;if(s==2){if(Math.min(t[0].x,t[1].x)-e.x>n||e.x-Math.max(t[0].x,t[1].x)>n)return 0;if(Math.min(t[0].y,t[1].y)-e.y>n||e.y-Math.max(t[0].y,t[1].y)>n)return 0;if(t[0].x==t[1].x)return Math.abs(t[0].x-e.x)<=n&&(e.y-t[0].y)*(e.y-t[1].y)<=0?1:0;if(t[0].y==t[1].y)return Math.abs(t[0].y-e.y)<=n&&(e.x-t[0].x)*(e.x-t[1].x)<=0?1:0;if(Math.abs(t[0].x-e.x)<n&&Math.abs(t[0].y-e.y)<n)return 1;if(Math.abs(t[1].x-e.x)<n&&Math.abs(t[1].y-e.y)<n)return 1;if(e.y!=t[0].y&&e.y!=t[1].y){var a=(t[1].x-t[0].x)/(t[1].y-t[0].y)*(e.y-t[0].y),f=(e.y-t[0].y)/Math.sqrt(a*a+(e.y-t[0].y)*(e.y-t[0].y)),l=f*(e.x-t[0].x-a);return Math.abs(l)<=n?1:0}return 0}for(r=0;r<s;++r)if(t[r].x==e.x&&t[r].y==e.y)return 1;e=jmUtils.clone(e);while(u){u=!1,o=!1;for(r=0,i=s-1;r<s;i=r++)if(t[r].y<e.y&&e.y<t[i].y||t[i].y<e.y&&e.y<t[r].y){if(e.x<=t[r].x||e.x<=t[i].x){var c=(e.y-t[r].y)*(t[i].x-t[r].x)/(t[i].y-t[r].y)+t[r].x;if(e.x<c)o=!o;else if(e.x==c)return 1}}else if(e.y==t[r].y){if(e.x<t[r].x){t[r].y>t[i].y?--e.y:++e.y,u=!0;break}}else if(t[r].y==t[i].y&&e.y==t[r].y&&(t[r].x<e.x&&e.x<t[i].x||t[i].x<e.x&&e.x<t[r].x)){o=!0;break}}return o?2:0},jmUtils.checkOutSide=function(e,t,n){var r={left:0,right:0,top:0,bottom:0};return n.x<0?r.left=t.left+n.x-e.left:n.x>0&&(r.right=t.right+n.x-e.right),n.y<0?r.top=t.top+n.y-e.top:n.y>0&&(r.bottom=t.bottom+n.y-e.bottom),r},jmUtils.guid=function(){var e=(new Date).getTime();return e},jmUtils.trimStart=function(e,t){t=t||" ";if(e&&e.length>0){var n=e[0];if(n===t||t.indexOf(n)>=0)return e=e.substring(1),jmUtils.trimStart(e,t)}return e},jmUtils.trimEnd=function(e,t){t=t||" ";if(e&&e.length>0){var n=e[e.length-1];if(n===t||t.indexOf(n)>=0)return e=e.substring(0,e.length-1),jmUtils.trimStart(e,t)}return e},jmUtils.trim=function(e,t){return jmUtils.trimEnd(jmUtils.trimStart(e,t),t)},jmUtils.checkPercent=function(e){if(typeof e=="string"){e=jmUtils.trim(e);if(e[e.length-1]=="%")return e}},jmUtils.percentToNumber=function(e){if(typeof e=="string"){var t=jmUtils.checkPercent(e);t&&(e=jmUtils.trim(t,"%"),e/=100)}return e},jmUtils.indexOf=function(e,t){if(jmUtils.isArray(t)){for(var n=0;n<t.length;n++)if(t[n]==e)return n}else if(typeof t=="string")return t.indexOf(e);return-1},jmUtils.parseXML=function(e){var t;if(DOMParser){var n=new DOMParser;t=n.parseFromString(e,"text/xml")}else{if(!window.ActiveXObject)return null;t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e)}return t},jmUtils.xmlToJSON=function(e){function t(e,n){if(e&&e.childNodes&&e.childNodes.length>0)for(var r=0;r<e.childNodes.length;r++){var i=e.childNodes[r];if(i.nodeType!=1)continue;var s=i.name||i.nodeName||i.tagName;if(s){var o={children:[],attributes:{}};if(i.attributes)for(var u in i.attributes){var a=i.attributes[u],f=a.name||a.nodeName;f&&(o.attributes[f]=jmUtils.trim(a.value||i.nodeValue||a.textContent))}o.name=s,o.value=jmUtils.trim(i.value||i.nodeValue||i.textContent),n.children.push(o),t(i,o)}else n.value=jmUtils.trim(i.value||i.nodeValue||i.textContent),t(i,n)}}if(!e)return null;typeof e=="string"&&(e=jmUtils.parseXML(e));var n={children:[]};return n.version=e.xmlVersion,n.title=e.title,t(e,n),n},jmUtils.hexToNumber=function(e){if(typeof e!="string")return e;e=e.toLowerCase();var t="0123456789abcdef",n=0,r=e.length;for(var i=r-1;i>=0;i--){var s=Number(t.indexOf(e[i]));if(s==0)continue;var o=r-i,u=1;for(var a=0;a<o;a++)u*=16;n+=s*u}return n},jmUtils.numberToHex=function(e){var t="0123456789abcdef",n="";while(e>0){var r=e%16;n=t[r]+n,e=Math.floor(e/16)}return n},jmUtils.toColor=function(e,t,n,r){if(typeof e=="string"){if(e.indexOf("rgb")>=0){e=this.trim(e,"rgba()) ");var i=e.split(",");e=i[0],t=i[1],n=i[2],r==undefined&&i.length>3&&(r=i[3])}else e.length<6?(n=e.substring(e.length-1,1),t=e.substring(e.length-2,1),e=e.substring(e.length-3,1),n+=""+n,t+=""+t,e+=""+e,e=this.hexToNumber(e),t=this.hexToNumber(t),n=this.hexToNumber(n)):(n=e.substring(e.length-2,2),t=e.substring(e.length-4,2),e.length>7&&(r=e.substring(e.length-8,2),r=this.hexToNumber(r)/255),e=e.substring(e.length-6,2),e=this.hexToNumber(e),t=this.hexToNumber(t),n=this.hexToNumber(n));return r?"rgba("+e+","+t+","+n+","+r+")":"rgb("+e+","+t+","+n+")"}return e=this.numberToHex(e),e=e.length==1?"0"+e:e,t=this.numberToHex(t),t=t.length==1?"0"+t:t,n=this.numberToHex(n),n=n.length==1?"0"+n:n,"#"+e+t+n},jmUtils.parseDate=function(e){if(jmUtils.isDate(e))return e;if(typeof e=="number")return new Date(e);var t=(e+",0,0,0").match(/\d+/g);return t[5]?new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5]):new Date(e)},jmUtils.formatDate=function(e,t){e=this.parseDate(e||new Date),t=t||"yyyy-MM-dd HH:mm:ss";var n=t.replace("yyyy",e.getFullYear().toString()).replace("MM",(e.getMonth()<9?"0":"")+(e.getMonth()+1).toString()).replace("dd",(e.getDate()<9?"0":"")+e.getDate().toString()).replace("HH",(e.getHours()<9?"0":"")+e.getHours().toString()).replace("mm",(e.getMinutes()<9?"0":"")+e.getMinutes().toString()).replace("ss",(e.getSeconds()<9?"0":"")+e.getSeconds().toString());return n},jmGradient.prototype.addColorStop=jmGradient.prototype.addStop=function(e,t){this.stops.add({offset:e,color:t})},jmGradient.prototype.toGradient=function(e){var t,n=e.context||e,r=this.x1,i=this.y1,s=this.x2,o=this.y2,u=e.getLocation(),a=0;u.radius&&(a=u.radius*2),a||(a=Math.min(u.width,u.height)),jmUtils.checkPercent(r)&&(r=jmUtils.percentToNumber(r)*(u.width||a)),jmUtils.checkPercent(s)&&(s=jmUtils.percentToNumber(s)*(u.width||a)),jmUtils.checkPercent(i)&&(i=jmUtils.percentToNumber(i)*(u.height||a)),jmUtils.checkPercent(o)&&(o=jmUtils.percentToNumber(o)*(u.height||a));if(this.type==="linear")e.mode=="canvas"?t=n.createLinearGradient(r+u.left,i+u.top,s+u.left,o+u.top):(t=Raphael.deg(Math.atan2(o-i,s-r))+"-",this.stops.each(function(e,n){t+=n.color+":"+Math.floor(n.offset*100)+"-"}),t=jmUtils.trimEnd(t,"-"));else if(this.type==="radial"){var f=this.r1,l=this.r2;jmUtils.checkPercent(f)&&(f=jmUtils.percentToNumber(f),f=a*f),jmUtils.checkPercent(l)&&(l=jmUtils.percentToNumber(l),l=a*l),e.mode=="canvas"?t=n.createRadialGradient(r+u.left,i+u.top,f,s+u.left,o+u.top,l):(t="r(",this.stops.each(function(e,n){t+=n.offset+","}),t=jmUtils.trimEnd(t,",")+")",this.stops.each(function(e,n){t+=n.color+"-"}),t=jmUtils.trimEnd(t,"-"))}return e.mode=="canvas"&&this.stops.each(function(e,n){t.addColorStop(n.offset,n.color)}),t},jmGradient.prototype.toString=function(){},jmObject.prototype.is=function(e){return typeof e=="string"?this.type==e:this instanceof e},jmObject.prototype.animate=function(e,t){if(this.is("jmGraph")){if(e){this.animateHandles||(this.animateHandles=new jmUtils.list);var n=[];if(arguments.length>2)for(var r=2;r<arguments.length;r++)n.push(arguments[r]);this.animateHandles.add({millisec:t||20,handle:e,params:n})}if(this.animateHandles&&this.animateHandles.count()>0){var i=this;this.dispatcher=setTimeout(function(e){e=e||i;var t=!1,n=[],r=(new Date).getTime();e.animateHandles.each(function(i,s){try{if(s&&s.handle&&(!s.times||r-s.times>=s.millisec)){var o=s.handle.apply(e,s.params);o===!1&&n.push(s),s.times=r,t=!0}}catch(u){window.console&&window.console.info&&window.console.info(u.toString()),s&&n.push(s)}});for(var s in n)e.animateHandles.remove(n[s]);t&&e.redraw(),e.animate()},10,this)}}else{var s=this.findParent("jmGraph");s&&s.animate.apply(s,arguments)}};var jmProperty=function(){this.__properties={},this.__eventHandles={}};jmUtils.extend(jmProperty,jmObject),jmProperty.prototype.getValue=function(e){return this.__properties||(this.__properties={}),this.__properties[e]},jmProperty.prototype.setValue=function(e,t){if(typeof t!="undefined"){this.__properties||(this.__properties={});var n={oldValue:this.getValue(e),newValue:t};this.__properties[e]=t,this.emit("PropertyChange",e,n)}return this.getValue(e)},jmProperty.prototype.on=function(e,t){this.__eventHandles||(this.__eventHandles={});var n=this.__eventHandles[e];n||(n=this.__eventHandles[e]=[]);for(var r in n)if(n[r]===t)return;n.push(t)},jmProperty.prototype.emit=function(e){var t=this.__eventHandles?this.__eventHandles[e]:null;if(t){var n=[],r=arguments.length;if(r>1)for(var i=1;i<r;i++)n.push(arguments[i]);for(var i in t)t[i].apply(this,n)}},jmUtils.extend(jmControl,jmProperty),jmControl.prototype.initializing=function(e,t){this.context=e,this.style=t||{},this.visible=!0;var n=this.mode||(this.mode=this.graph.mode);n!=="canvas"&&!this.svgShape&&this.type!=="jmGraph"&&(this.svgShape=this.context.create("path",this));var r=this;this.children=function(){var e=new jmUtils.list,t=e.add;return e.add=function(e){if(typeof e=="object")return e.parent&&e.parent!=r&&e.parent.children&&e.parent.children.remove(e),e.parent=r,this.contain(e)&&this.oremove(e),t.call(this,e),e.emit("add",e),e},e.oremove=e.remove,e.remove=function(e){typeof e=="object"&&(e.parent=null,e.remove(!0),this.oremove(e))},e.sort=function(){var n={};e.each(function(e,t){var r=t.zIndex;!r&&t.style&&t.style.zIndex&&(r=Number(t.style.zIndex));if(r){var i=n[r]||(n[r]=[]);i.push(t)}});for(var r in n)t.call(this,n[r])},e.clear=function(){e.each(function(e,t){this.remove(t)},!0)},e}()},jmControl.prototype.cursor=function(e){if(this.svgShape)this.svgShape.css("cursor",e);else{var t=this.graph||this.findParent("jmGraph");t&&t.css("cursor",e)}},jmControl.prototype.setStyle=function(e){function t(e,n,r,i){var s=n[r];if(s)if(!e.mode||e.mode=="canvas"){var o="jm_control_style_mapping",u=jmUtils.cache.get(o);u||(u={fill:"fillStyle",stroke:"strokeStyle","shadow.blur":"shadowBlur","shadow.x":"shadowOffsetX","shadow.y":"shadowOffsetY","shadow.color":"shadowColor",lineWidth:"lineWidth",fillStyle:"fillStyle",strokeStyle:"strokeStyle",font:"font",opacity:"globalAlpha",textAlign:"textAlign",textBaseline:"textBaseline",shadowBlur:"shadowBlur",shadowOffsetX:"shadowOffsetX",shadowOffsetY:"shadowOffsetY",shadowColor:"shadowColor",lineJoin:"lineJoin",lineCap:"lineCap"},jmUtils.cache.add(o,u));var a=typeof s;if(a=="object"&&!u[r])switch(r){case"shadow":for(var f in s)t(e,s,f,r+"."+f);break;case"translate":e.context.translate(s.x,s.y)}else if(a=="object"&&jmUtils.isType(s,jmGradient)){var l=u[i||r]||r;e.context[l]=s.toGradient(e)}else if(a!="function"&&a!="object"){var l=u[i||r];if(l)e.context[l]=s;else switch(r){case"rotate":var c=0,h=0;if(e.rotatePosition){var p=e.parent&&e.parent.absoluteBounds?e.parent.absoluteBounds:e.absoluteBounds;c=e.rotatePosition.x+p.left,h=e.rotatePosition.y+p.top}e.context.translate(c,h),e.context.rotate(s);break;case"transform":jmUtils.isArray(s)?e.context.transform.apply(e.context,s):typeof s=="object"&&e.context.transform(s.scaleX,s.skewX,s.skewY,s.scaleY,s.offsetX,s.offsetY);break;case"translate":e.context.translate(s.x,s.y);break;case"cursor":e.cursor(s)}}}else e.svgShape&&e.svgShape.attr(i||r,s)}e=e||this.style;if(!e)return;this.translate&&t(this,{translate:this.translate},"translate"),this.transform&&t(this,{transform:this.transform},"transform"),this.rotate&&t(this,{rotate:this.rotate},"rotate");for(var n in e)t(this,e,n)},jmControl.prototype.getBounds=function(){var e={};if(this.points&&this.points.length>0)for(var t in this.points){var n=this.points[t];if(typeof e.left=="undefined"||e.left>n.x)e.left=n.x;if(typeof e.top=="undefined"||e.top>n.y)e.top=n.y;if(typeof e.right=="undefined"||e.right<n.x)e.right=n.x;if(typeof e.bottom=="undefined"||e.bottom<n.y)e.bottom=n.y}else if(this.getLocation){var n=this.getLocation();n&&(e.left=n.left,e.top=n.top,e.right=n.left+n.width,e.bottom=n.top+n.height)}return e.left||(e.left=0),e.top||(e.top=0),e.right||(e.right=0),e.bottom||(e.bottom=0),e.width=e.right-e.left,e.height=e.bottom-e.top,e},jmControl.prototype.getLocation=function(e){if(e!==!0&&this.location)return this.location;var t=this.location={left:0,top:0,width:0,height:0},n=this.position();t.center=this.center&&typeof this.center=="function"?jmUtils.clone(this.center()):null,t.radius=this.radius?this.radius():null,t.width=this.width()||0,t.height=this.height()||0;var r=this.style.margin||{};r.left=r.left||0,r.top=r.top||0,r.right=r.right||0,r.bottom=r.bottom||0,n?(t.left=n.x,t.top=n.y):(t.left=r.left,t.top=r.top);if(!this.parent)return t;var i=this.parent.bounds?this.parent.bounds:this.parent.getBounds();return jmUtils.checkPercent(t.left)&&(t.left=jmUtils.percentToNumber(t.left)*i.width),jmUtils.checkPercent(t.top)&&(t.top=jmUtils.percentToNumber(t.top)*i.height),jmUtils.checkPercent(t.width)&&(t.width=jmUtils.percentToNumber(t.width)*i.width),jmUtils.checkPercent(t.height)&&(t.height=jmUtils.percentToNumber(t.height)*i.height),t.center&&(jmUtils.checkPercent(t.center.x)&&(t.center.x=jmUtils.percentToNumber(t.center.x)*i.width),jmUtils.checkPercent(t.center.y)&&(t.center.y=jmUtils.percentToNumber(t.center.y)*i.height)),t.radius&&jmUtils.checkPercent(t.radius)&&(t.radius=jmUtils.percentToNumber(t.radius)*Math.min(i.width,i.height)),t},jmControl.prototype.remove=function(){this.svgShape&&this.svgShape.remove(),this.parent&&this.parent.children.remove(this)},jmControl.prototype.position=function(e){return this.setValue("position",e)},jmControl.prototype.width=function(e){return this.setValue("width",e)},jmControl.prototype.height=function(e){return this.setValue("height",e)},jmControl.prototype.offset=function(e,t,n){n=n===!1?!1:!0;var r=this.getLocation(!0),i=!1;if(this.center&&typeof this.center=="function"){var s=this.center();s&&(s.x=r.center.x+e,s.y=r.center.y+t,i=!0)}if(i==0&&this.position&&typeof this.position=="function"){var o=this.position();o&&(r.left+=e,r.top+=t,o.x=r.left,o.y=r.top,i=!0)}if(i==0&&this.cpoints&&typeof this.cpoints=="function"){var o=this.cpoints();if(o){var u=o.length;for(var a=0;a<u;a++)o[a].x+=e,o[a].y+=t;i=!0}}if(i==0&&this.points){var u=this.points.length;for(var a=0;a<u;a++)this.points[a].x+=e,this.points[a].y+=t;i=!0}this.emit("move",{offsetX:e,offsetY:t,trans:n}),this.graph.refresh()},jmControl.prototype.getAbsoluteBounds=function(){var e=this.bounds||this.getBounds();if(this.parent&&this.parent.absoluteBounds){var t=this.parent.absoluteBounds||this.parent.getAbsoluteBounds();return{left:t.left+e.left,top:t.top+e.top,right:t.left+e.right,bottom:t.top+e.bottom,width:e.width,height:e.height}}return e},jmControl.prototype.beginDraw=function(){this.getLocation(!0),this.context.beginPath()},jmControl.prototype.endDraw=function(){this.style.close&&this.context.closePath(),this.style.fill&&this.context.fill(),(this.style.stroke||!this.style.fill)&&this.context.stroke()},jmControl.prototype.draw=function(){if(this.points&&this.points.length>0){var e=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds;if(!this.mode||this.mode=="canvas"){this.context.moveTo(this.points[0].x+e.left,this.points[0].y+e.top);var t=this.points.length;for(var n=1;n<t;n++){var r=this.points[n];r.m?this.context.moveTo(r.x+e.left,r.y+e.top):this.context.lineTo(r.x+e.left,r.y+e.top)}}else{this.svgShape.setStyle(this);var i=this.points.slice(0),t=i.length;for(var n=0;n<t;n++)i[n].x+=e.left,i[n].y+=e.top;this.svgShape.attr("path",i,this.style.close)}}},jmControl.prototype.paint=function(e){e!==!1&&this.visible!==!1?(this.svgShape&&this.svgShape.show(),this.initPoints&&this.initPoints(),this.bounds=this.getBounds(),this.absoluteBounds=this.getAbsoluteBounds(),this.context.save(),this.svgShape&&this.svgShape.glow&&this.svgShape.glow.remove(),this.setStyle(),this.emit("beginDraw",this),this.beginDraw&&this.beginDraw(),this.draw&&this.draw(),this.endDraw&&this.endDraw(),this.children&&(this.children.sort(),this.children.each(function(e,t){t&&t.paint&&t.paint()})),this.emit("endDraw",this),this.context.restore()):this.svgShape&&(this.svgShape.hide(),this.children&&this.children.each(function(e,t){t&&t.paint&&t.paint(!1)}))},jmControl.prototype.getEvent=function(e){return this.__events?this.__events[e]:null},jmControl.prototype.bind=function(e,t){function n(e,t){return this.__events||(this.__events={}),this.__events[e]=t}var r=this.getEvent(e)||n.call(this,e,new jmUtils.list);r.contain(t)||r.add(t)},jmControl.prototype.unbind=function(e,t){var n=this.getEvent(e);n&&n.remove(t)},jmControl.prototype.checkPoint=function(e){var t=this.bounds||this.getBounds();return e.x>t.right||e.x<t.left?!1:e.y>t.bottom||e.y<t.top?!1:!0},jmControl.prototype.raiseEvent=function(e,t){if(this.visible===!1)return;if(!t.position){var n=this.findParent("jmGraph"),r=jmUtils.getEventPosition(t,n.scaleSize);if(this.mode!=="canvas"){var i=n.getPosition();r.x=r.offsetX=r.pageX-i.left,r.y=r.offsetY=r.pageY-i.top}var s=t.srcElement||t.target;t={position:r,button:t.button==0?1:t.button,keyCode:t.keyCode||t.charCode||t.which,ctrlKey:t.ctrlKey,cancel:!1,srcElement:s}}this.children&&this.children.each(function(n,r){t.cancel!==!0&&r.raiseEvent(e,t)},!0);var o=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds;return o?(t.position.x=t.position.offsetX-o.left,t.position.y=t.position.offsetY-o.top,this.checkPoint(t.position)?(t.target||(t.target=this),t.cancel!==!0&&runEventHandle.call(this,e,t),!this.focused&&e=="mousemove"&&(this.focused=!0,this.raiseEvent("mouseover",t))):this.focused&&e=="mousemove"&&(this.focused=!1,runEventHandle.call(this,"mouseleave",t)),t.cancel==0):!1},jmControl.prototype.clearEvents=function(e){var t=this.getEvent(e);t&&t.clear},jmControl.prototype.findParent=function(e){if(typeof e=="string"){if(this.type==e)return this}else if(this.is(e))return this;return this.parent?this.parent.findParent(e):null},jmControl.prototype.canMove=function(e,t){if(!this.__mvMonitor){this.__mvMonitor={},this.__mvMonitor.mouseDown=!1,this.__mvMonitor.curposition={x:0,y:0};var n=this;this.__mvMonitor.mv=function(e){var t=n;if(t.__mvMonitor.mouseDown){t.parent.bounds=null;var r=t.parent.getAbsoluteBounds(),i=e.position.x-t.__mvMonitor.curposition.x,s=e.position.y-t.__mvMonitor.curposition.y;if(t.lockSide){var o=t.bounds||t.getAbsoluteBounds(),u=jmUtils.checkOutSide(r,o,{x:i,y:s});u.left<0?t.lockSide.left&&(i-=u.left):u.right>0&&t.lockSide.right&&(i-=u.right),u.top<0?t.lockSide.top&&(s-=u.top):u.bottom>0&&t.lockSide.bottom&&(s-=u.bottom)}return i&&s&&(t.offset(i,s),t.__mvMonitor.curposition.x=e.position.x,t.__mvMonitor.curposition.y=e.position.y),!1}},this.__mvMonitor.mu=function(e){var t=n;t.__mvMonitor.mouseDown&&(t.__mvMonitor.mouseDown=!1,t.cursor("default"),t.emit("moveend",{position:t.__mvMonitor.curposition}))},this.__mvMonitor.ml=function(){var e=n;if(e.__mvMonitor.mouseDown)return e.__mvMonitor.mouseDown=!1,e.cursor("default"),e.emit("moveend",{position:e.__mvMonitor.curposition}),!1},this.__mvMonitor.md=function(e){var t=n;if(t.__mvMonitor.mouseDown)return;if(e.button==0||e.button==1){t.__mvMonitor.mouseDown=!0,t.cursor("move");var r=t.parent.absoluteBounds||t.parent.getAbsoluteBounds();return t.__mvMonitor.curposition.x=e.position.x+r.left,t.__mvMonitor.curposition.y=e.position.y+r.top,t.emit("movestart",{position:t.__mvMonitor.curposition}),e.cancel=!0,!1}}}t=t||this.graph||this.findParent("jmGraph"),t&&e?(t.bind("mousemove",this.__mvMonitor.mv),t.bind("mouseup",this.__mvMonitor.mu),t.bind("mouseleave",this.__mvMonitor.ml),this.bind("mousedown",this.__mvMonitor.md),t.bind("touchmove",this.__mvMonitor.mv),t.bind("touchend",this.__mvMonitor.mu),this.bind("touchstart",this.__mvMonitor.md)):(t.unbind("mousemove",this.__mvMonitor.mv),t.unbind("mouseup",this.__mvMonitor.mu),t.unbind("mouseleave",this.__mvMonitor.ml),this.unbind("mousedown",this.__mvMonitor.md),t.unbind("touchmove",this.__mvMonitor.mv),t.unbind("touchend",this.__mvMonitor.mu),this.unbind("touchstart",this.__mvMonitor.md))},jmUtils.extend(jmShape,jmControl),jmUtils.extend(jmPath,jmShape),jmPath.prototype.checkPoint=function(e){var t=this.style.lineWidth||1;if(this.points.length>2&&(!this.style.fill||this.style.stroke)){var n=0,r=this.points.length;for(var i=n+1;i<=r;i=++n+1)if(i==r){if(this.style.close){var s=jmUtils.pointInPolygon(e,[this.points[n],this.points[0]],t);if(s)return!0}}else{var o=jmUtils.pointInPolygon(e,[this.points[n],this.points[i]],t);if(o)return!0}if(!this.style.fill)return!1}var s=jmUtils.pointInPolygon(e,this.points,t);return s},jmUtils.extend(jmLine,jmPath),jmLine.prototype.initPoints=function(){var e=this.start(),t=this.end();this.points=[],this.points.push(e);if(this.style.lineType==="dotted"){var n=t.x-e.x,r=t.y-e.y,i=Math.sqrt(n*n+r*r);n/=i,r/=i;var s=!1,o=this.style.dashLength/2;for(var u=this.style.dashLength;u<=i;)s==0?(this.points.push({x:e.x+n*u,y:e.y+r*u}),u+=o):(this.points.push({x:e.x+n*u,y:e.y+r*u,m:!0}),u+=this.style.dashLength),s=!s}return this.points.push(t),this.points},jmLine.prototype.start=function(e){return this.setValue("start",e)},jmLine.prototype.end=function(e){return this.setValue("end",e)},jmUtils.extend(jmCircle,jmPath),jmCircle.prototype.initPoints=function(){var e=this.getLocation();e.radius||(e.radius=Math.min(e.width,e.height)/2),this.points=[],this.points.push({x:e.center.x-e.radius,y:e.center.y-e.radius}),this.points.push({x:e.center.x+e.radius,y:e.center.y-e.radius}),this.points.push({x:e.center.x+e.radius,y:e.center.y+e.radius}),this.points.push({x:e.center.x-e.radius,y:e.center.y+e.radius})},jmCircle.prototype.draw=function(){var e=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds,t=this.getLocation();t.radius||(t.radius=Math.min(t.width,t.height)/2),!this.mode||this.mode=="canvas"?this.context.arc(t.center.x+e.left,t.center.y+e.top,t.radius,0,Math.PI*2):(this.svgShape||(this.svgShape=this.context.create("circle",this),this.setStyle(),this.svgShape.appendTo(this.graph.canvas)),this.svgShape.setStyle(this),this.svgShape.attr({cx:t.center.x+e.left,cy:t.center.y+e.top,r:t.radius}))},jmCircle.prototype.center=function(e){return this.setValue("center",e)},jmCircle.prototype.radius=function(e){return this.setValue("radius",e)},jmUtils.extend(jmArc,jmPath),jmArc.prototype.initPoints=function(){var e=this.getLocation(),t=0,n=0,r=e.center.x,i=e.center.y;e.radius?t=n=e.radius:(t=e.width/2,n=e.height/2);var s=this.startAngle(),o=this.endAngle(),u=this.anticlockwise();this.points=[];if(s<o)for(var a=s;a<=o;a+=.01){var f=u?-a:a,l={x:Math.cos(f)*t+r,y:Math.sin(f)*n+i};this.points.push(l)}else for(var a=s;a>=o;a-=.01){var f=u?-a:a,l={x:Math.cos(f)*t+r,y:Math.sin(f)*n+i};this.points.push(l)}return this.points},jmArc.prototype.center=function(e){return this.setValue("center",e)},jmArc.prototype.radius=function(e){return this.setValue("radius",e)},jmArc.prototype.startAngle=function(e){return this.setValue("startAngle",e)},jmArc.prototype.endAngle=function(e){return this.setValue("endAngle",e)},jmArc.prototype.anticlockwise=function(e){return this.setValue("anticlockwise",e)},jmUtils.extend(jmHArc,jmPath),jmHArc.prototype.initPoints=function(){var e=this.getLocation(),t=this.minRadius(),n=this.maxRadius(),r=this.startAngle(),i=this.endAngle(),s=this.anticlockwise(),o=[],u=[];for(var a=r;a<=i;a+=.1){var f=s?-a:a,l=Math.cos(f),c=Math.sin(f),h={x:l*t+e.center.x,y:c*t+e.center.y},p={x:l*n+e.center.x,y:c*n+e.center.y};o.push(h),u.push(p)}u.reverse();if(!this.style||!this.style.close)u[0].m=!0;this.points=o.concat(u)},jmHArc.prototype.center=function(e){return this.setValue("center",e)},jmHArc.prototype.minRadius=function(e){return this.setValue("minRadius",e)},jmHArc.prototype.maxRadius=function(e){return this.setValue("maxRadius",e)},jmHArc.prototype.startAngle=function(e){return this.setValue("startAngle",e)},jmHArc.prototype.endAngle=function(e){return this.setValue("endAngle",e)},jmHArc.prototype.anticlockwise=function(e){return this.setValue("anticlockwise",e)},jmUtils.extend(jmPrismatic,jmPath),jmPrismatic.prototype.initPoints=function(){var e=this.getLocation(),t=e.width/2,n=e.height/2;this.points=[],this.points.push({x:e.center.x-t,y:e.center.y}),this.points.push({x:e.center.x,y:e.center.y+n}),this.points.push({x:e.center.x+t,y:e.center.y}),this.points.push({x:e.center.x,y:e.center.y-n})},jmPrismatic.prototype.center=function(e){return this.setValue("center",e)},jmUtils.extend(jmBezier,jmPath),jmBezier.prototype.initPoints=function(){this.points=[];var e=this.cpoints();for(var t=0;t<=1;t+=.01){var n=this.getPoint(e,t);this.points.push(n)}return this.points.push(e[e.length-1]),this.points},jmBezier.prototype.getPoint=function(e,t){if(e.length==1)return e[0];if(e.length==2){var n={};return n.x=(e[1].x-e[0].x)*t+e[0].x,n.y=(e[1].y-e[0].y)*t+e[0].y,n}if(e.length>2){var r=[];for(var i=0;i<e.length-1;i++){var n=this.getPoint([e[i],e[i+1]],t);n&&r.push(n)}return this.getPoint(r,t)}},jmBezier.prototype.offset=function(e,t,n){var r=this.cpoints();if(r){var i=r.length;for(var s=0;s<i;s++)r[s].x+=e,r[s].y+=t;this.emit("move",{offsetX:e,offsetY:t,trans:n}),this.getLocation(!0),this.graph.refresh()}},jmBezier.prototype.cpoints=function(e){return this.setValue("cpoints",e)},jmUtils.extend(jmRect,jmPath),jmRect.prototype.getBounds=function(){var e={};this.initPoints();var t=this.position();return e.left=t.x,e.top=t.y,e.right=t.x+this.width(),e.bottom=t.y+this.height(),e.width=e.right-e.left,e.height=e.bottom-e.top,e},jmRect.prototype.checkPoint=function(e){var t=this.bounds||this.getBounds();return e.x>t.right||e.x<t.left?!1:e.y>t.bottom||e.y<t.top?!1:!0},jmRect.prototype.initPoints=function(){var e=this.getLocation(),t={x:e.left,y:e.top},n={x:e.left+e.width,y:e.top},r={x:e.left+e.width,y:e.top+e.height},i={x:e.left,y:e.top+e.height};if(e.radius&&e.radius<e.width/2&&e.radius<e.height/2){var s=Math.PI/2,o=this.graph.createShape("arc",{radius:e.radius,anticlockwise:!1});o.center({x:e.left+e.radius,y:e.top+e.radius}),o.startAngle(Math.PI),o.endAngle(Math.PI+s);var u=o.initPoints();o=this.graph.createShape("arc",{radius:e.radius,anticlockwise:!1}),o.center({x:n.x-e.radius,y:n.y+e.radius}),o.startAngle(Math.PI+s),o.endAngle(Math.PI*2);var a=o.initPoints();o=this.graph.createShape("arc",{radius:e.radius,anticlockwise:!1}),o.center({x:r.x-e.radius,y:r.y-e.radius}),o.startAngle(0),o.endAngle(s);var f=o.initPoints();o=this.graph.createShape("arc",{radius:e.radius,anticlockwise:!1}),o.center({x:i.x+e.radius,y:i.y-e.radius}),o.startAngle(s),o.endAngle(Math.PI);var l=o.initPoints();this.points=u.concat(a,f,l)}else this.points=[],this.points.push(t),this.points.push(n),this.points.push(r),this.points.push(i);return this.points},jmRect.prototype.radius=function(e){return this.setValue("radius",e)},jmUtils.extend(jmArraw,jmPath),jmArraw.prototype.initPoints=function(e){var t=this.angle(),n=this.start(),r=this.end();if(!r)return;t||(t=Math.atan2(r.y-n.y,r.x-n.x)),this.points=[];var i=this.offsetX(),s=this.offsetY(),o=Math.atan2(i,s),u=t+o,a=Math.sin(u),f=Math.cos(u),l=Math.sqrt(i*i+s*s),c=a*l,h=f*l,p={x:r.x-h,y:r.y-c},d=t-o;a=Math.sin(d),f=Math.cos(d),c=a*l,h=f*l;var v={x:r.x-h,y:r.y-c},m=jmUtils.clone(r);return m.m=!0,this.points.push(m),this.points.push(p),e||this.style.fill?(this.points.push(v),this.points.push(m)):(this.points.push(m),this.points.push(v)),this.points},jmArraw.prototype.start=function(e){return this.setValue("start",e)},jmArraw.prototype.end=function(e){return this.setValue("end",e)},jmArraw.prototype.angle=function(e){return this.setValue("angle",e)},jmArraw.prototype.offsetX=function(e){return this.setValue("offsetX",e)},jmArraw.prototype.offsetY=function(e){return this.setValue("offsetY",e)},jmUtils.extend(jmLabel,jmControl),jmLabel.prototype.initPoints=function(){var e=this.getLocation(),t=e.width,n=e.height;return this.points=[{x:e.left,y:e.top}],this.points.push({x:e.left+e.width,y:e.top}),this.points.push({x:e.left+e.width,y:e.top+e.height}),this.points.push({x:e.left,y:e.top+e.height}),this.points},jmLabel.prototype.testSize=function(){this.context.save(),this.setStyle();var e=this.context.measureText?this.context.measureText(this.value):{width:this.svgShape?this.svgShape.element.getBBox().width:15};return this.context.restore(),e.height=15,e},jmLabel.prototype.draw=function(){var e=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds,t=this.getLocation(),n=t.left+e.left,r=t.top+e.top;switch(this.style.textAlign){case"right":n+=t.width;break;case"center":n+=t.width/2}switch(this.style.textBaseline){case"bottom":r+=t.height;break;case"hanging":case"alphabetic":case"middle":r+=t.height/2}this.mode=="canvas"?(this.value&&(this.style.fill&&this.context.fillText?this.style.maxWidth?this.context.fillText(this.value,n,r,this.style.maxWidth):this.context.fillText(this.value,n,r):this.context.strokeText&&(this.style.maxWidth?this.context.strokeText(this.value,n,r,this.style.maxWidth):this.context.strokeText(this.value,n,r))),this.style.border&&(this.context.moveTo(this.points[0].x+e.left,this.points[0].y+e.top),this.style.border.top&&this.context.lineTo(this.points[1].x+e.left,this.points[1].y+e.top),this.style.border.right&&(this.context.moveTo(this.points[1].x+e.left,this.points[1].y+e.top),this.context.lineTo(this.points[2].x+e.left,this.points[2].y+e.top)),this.style.border.bottom&&(this.context.moveTo(this.points[2].x+e.left,this.points[2].y+e.top),this.context.lineTo(this.points[3].x+e.left,this.points[3].y+e.top)),this.style.border.left&&(this.context.moveTo(this.points[3].x+e.left,this.points[3].y+e.top),this.context.lineTo(this.points[0].x+e.left,this.points[0].y+e.top)))):this.svgShape.attr({x:n,y:r,text:this.value})},jmLabel.prototype.width=function(e){if(e)return this.setValue("width",e);e=this.getValue("width");if(e)return e;if(this.context)return this.testSize().width},jmUtils.extend(jmImage,jmControl),jmImage.prototype.draw=function(){try{var e=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds;e||(e=this.parent&&this.parent.getAbsoluteBounds?this.parent.getAbsoluteBounds():this.getAbsoluteBounds());var t=this.getLocation();t.left+=e.left,t.top+=e.top;var n=this.sourcePosition(),r=this.sourceWidth(),i=this.sourceHeight(),s=this.image();if(r||i)r||(r=t.width),i||(i=t.height),n||(n={x:0,y:0});n?t.width&&t.height?this.context.drawImage(s,n.x,n.y,r,i,t.left,t.top,t.width,t.height):t.width?this.context.drawImage(s,n.x,n.y,r,i,t.left,t.top,t.width,s.height):t.height?this.context.drawImage(s,n.x,n.y,r,i,t.left,t.top,s.width,t.height):this.context.drawImage(s,n.x,n.y,r,i,t.left,t.top):t?t.width&&t.height?this.context.drawImage(s,t.left,t.top,t.width,t.height):t.width?this.context.drawImage(s,t.left,t.top,t.width,s.height):t.height?this.context.drawImage(s,t.left,t.top,s.width,t.height):this.context.drawImage(s,t.left,t.top):this.context.drawImage(this.image())}catch(o){console.log(o)}},jmImage.prototype.getBounds=function(){var e={},t=this.image(),n=this.getLocation(),r=n.width||t.width,i=n.height||t.height;return e.left=n.left,e.top=n.top,e.right=n.left+r,e.bottom=n.top+i,e.width=r,e.height=i,e},jmImage.prototype.image=function(e){if(e&&typeof e=="string"){var t=document.createElement("img");t.src=e,e=t}return this.setValue("image",e)},jmImage.prototype.position=function(e){return this.setValue("position",e)},jmImage.prototype.sourcePosition=function(e){return this.setValue("sourcePosition",e)},jmImage.prototype.sourceWidth=function(e){return this.setValue("sourceWidth",e)},jmImage.prototype.sourceHeight=function(e){return this.setValue("sourceHeight",e)},jmUtils.extend(jmResize,jmRect),jmResize.prototype.init=function(){if(this.params.resizable===!1)return;this.resizeRects=[];var e=this.rectSize();for(var t=0;t<8;t++){var n=this.graph.createShape("rect",{position:{x:0,y:0},width:e,height:e,style:{stroke:this.style.rectStroke||"red",close:!0,zIndex:100}});n.index=t,n.visible=!0,this.resizeRects.push(n),this.children.add(n),n.canMove(!0,this.graph)}this.reset(0,0,0,0),this.bindRectEvents()},jmResize.prototype.bindRectEvents=function(){var e=this;for(var t in this.resizeRects){var n=this.resizeRects[t];n.on("move",function(t){var n=0,r=0,i=0,s=0;this.index==0?(i=-t.offsetX,n=t.offsetX):this.index==1?(i=-t.offsetX,n=t.offsetX,s=-t.offsetY,r=t.offsetY):this.index==2?(s=-t.offsetY,r=t.offsetY):this.index==3?(i=t.offsetX,s=-t.offsetY,r=t.offsetY):this.index==4?i=t.offsetX:this.index==5?(i=t.offsetX,s=t.offsetY):this.index==6?s=t.offsetY:this.index==7&&(i=-t.offsetX,n=t.offsetX,s=t.offsetY),e.reset(n,r,i,s)}),n.bind("mousemove",function(){var e=["w-resize","nw-resize","n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize"];this.cursor(e[this.index])}),n.bind("mouseleave",function(){this.cursor("default")})}},jmResize.prototype.reset=function(e,t,n,r){var i=5,s=this.getLocation();if(n!=0||r!=0){var o=s.width+n,u=s.height+r;if(o>=i&&u>=i){this.width(o),this.height(u);if(this.params.movable!==!1){var a=this.position();a.x=s.left+e,a.y=s.top+t,this.position(a)}this.emit("resize",e,t,n,r)}}for(var f in this.resizeRects){var l=this.resizeRects[f];switch(l.index){case 0:l.position().x=-l.width()/2,l.position().y=(s.height-l.height())/2;break;case 1:l.position().x=-l.width()/2,l.position().y=-l.height()/2;break;case 2:l.position().x=(s.width-l.width())/2,l.position().y=-l.height()/2;break;case 3:l.position().x=s.width-l.width()/2,l.position().y=-l.height()/2;break;case 4:l.position().x=s.width-l.width()/2,l.position().y=(s.height-l.height())/2;break;case 5:l.position().x=s.width-l.width()/2,l.position().y=s.height-l.height()/2;break;case 6:l.position().x=(s.width-l.height())/2,l.position().y=s.height-l.height()/2;break;case 7:l.position().x=-l.width()/2,l.position().y=s.height-l.height()/2}}},jmResize.prototype.rectSize=function(e){return this.setValue("rectSize",e)},jmResize.prototype.target=function(e){return this.setValue("target",e)},jmUtils.extend(jmArrawLine,jmPath),jmArrawLine.prototype.initPoints=function(){return this.points=this.line.initPoints(),this.arrawVisible!==!1&&(this.points=this.points.concat(this.arraw.initPoints())),this.points},jmUtils.extend(jmTooltip,jmControl),jmTooltip.prototype.setStyle=function(e){e=e||this.style;if(e&&typeof e=="object")for(var t in e){if(typeof t!="string"||typeof e[t]!="string")continue;try{this.element.style[t]=e[t]}catch(n){window.console.log(n)}}},jmTooltip.prototype.draw=function(){this.setPosition()},jmTooltip.prototype.setPosition=function(e,t){this.x=e||this.x||0,this.y=t||this.y||0;var n=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds,r=this.getLocation();e=this.x+r.left+n.left,t=this.y+r.top+n.top;var i=this.graph.getPosition();e+=i.left,t+=i.top,this.element.style.top=t+"px",this.element.style.left=e+"px"},jmTooltip.prototype.remove=function(){this.element&&document.body.removeChild(this.element)},jmTooltip.prototype.show=function(){this.element&&(this.element.style.display="inline")},jmTooltip.prototype.hide=function(){this.element&&(this.element.style.display="none")},jmTooltip.prototype.value=function(e){if(this.element)return e!==undefined&&(this.element.innerHTML=e),this.element.innerHTML},jmTooltip.prototype.width=function(e){if(this.element)return e!==undefined&&(this.element.style.width=e+"px"),this.element.clientWidth},jmTooltip.prototype.height=function(e){if(this.element)return e!==undefined&&(this.element.style.height=e+"px"),this.element.clientHeight},jmUtils.extend(jmGraph,jmControl),jmGraph.prototype.registerShape=function(e,t){e="jmGraph.shapes."+e,jmUtils.cache.get(e)||jmUtils.cache.set(e,t)},jmGraph.prototype.createShape=function(e,t){e="jmGraph.shapes."+e;var n=jmUtils.cache.get(e);if(n){t||(t={}),t.mode=this.mode;var r=new n(this,t);return r}},jmGraph.prototype.isSupportedBrowser=function(){var e=jmUtils.browser();return!e.msie||e.ver>8},jmGraph.prototype.createShadow=function(e,t,n,r){var i=new jmShadow(e,t,n,r);return i},jmGraph.prototype.createLinearGradient=function(e,t,n,r){var i=new jmGradient({type:"linear",x1:e,y1:t,x2:n,y2:r});return i},jmGraph.prototype.createRadialGradient=function(e,t,n,r,i,s){var o=new jmGradient({type:"radial",x1:e,y1:t,r1:n,x2:r,y2:i,r2:s});return o},jmGraph.prototype.refresh=function(){this.animate(function(){return!1},100,"jmgraph_refresh")},jmGraph.prototype.redraw=function(e,t){this.clear(e,t),this.paint()},jmGraph.prototype.clear=function(e,t){e&&t?(this.canvas.width=e,this.canvas.height=t,this.scaleSize&&this.context.scale&&this.context.scale(this.scaleSize.x,this.scaleSize.y)):(e=this.canvas.width,t=this.canvas.height,this.scaleSize&&(e/=this.scaleSize.x,t/=this.scaleSize.y)),this.context.clearRect&&this.context.clearRect(0,0,e,t)},jmGraph.prototype.css=function(e,t){this.canvas&&(this.canvas.style[e]=t)},jmGraph.prototype.createPath=function(e,t){var n=this.createShape("path",{points:e,style:t});return n},jmGraph.prototype.createLine=function(e,t,n){var r=this.createShape("line",{start:e,end:t,style:n});return r},jmGraph.prototype.getBounds=function(){var e={};return e.left=0,e.top=0,typeof this.canvas.width=="function"?e.right=this.canvas.width():e.right=this.canvas.width,typeof this.canvas.height=="function"?e.bottom=this.canvas.height():e.bottom=this.canvas.height,e.width=e.right,e.height=e.bottom,e},jmGraph.prototype.getPosition=function(){var e=jmUtils.getElementPosition(this.canvas.canvas||this.canvas);return e.width=this.canvas.width,e.height=this.canvas.height,e.right=e.left+e.width,e.bottom=e.top+e.height,e},jmGraph.prototype.checkPoint=function(e){var t=this.getPosition();return e.pageX>t.right||e.pageX<t.left?!1:e.pageY>t.bottom||e.pageY<t.top?!1:!0},jmGraph.prototype.zoomOut=function(){this.scale(.9,.9)},jmGraph.prototype.zoomIn=function(){this.scale(1.1,1.1)},jmGraph.prototype.zoomActual=function(){this.scaleSize?this.scale(1/this.scaleSize.x,1/this.scaleSize.y):this.scale(1,1)},jmGraph.prototype.width=function(e){return typeof e!="undefined"&&(this.canvas.width=e),this.canvas.width},jmGraph.prototype.height=function(e){return typeof e!="undefined"&&(this.canvas.height=e),this.canvas.height},jmGraph.prototype.scale=function(e,t){this.normalSize||(this.normalSize={width:this.canvas.width,height:this.canvas.height}),this.context.scale(e,t),this.scaleSize?this.scaleSize={x:e*this.scaleSize.x,y:t*this.scaleSize.y}:this.scaleSize={x:e,y:t},this.refresh()},jmGraph.prototype.toDataURL=function(){var e=this.canvas.toDataURL?this.canvas.toDataURL():"";return e},jmUtils.extend(jmCell,jmControl),jmCell.prototype.setStyle=function(e){if(e){var t=this.editor.styles[e];t?(this.styleName=e,this.style=jmUtils.clone(t)):(this.style=jmUtils.clone(e),t=e),typeof this.style.resizable!="undefined"&&(this.resizable=this.style.resizable),this.style.zIndex=this.style.zIndex||1e3,this.fontStyle=t.fontStyle||this.editor.defaultStyle.font,this.style.padding=this.style.padding||{left:8,top:8,right:8,bottom:8},this.label&&(this.label.style=this.fontStyle),this.shape&&(t.zIndex=0,this.shape.style=t)}},jmCell.prototype.create=function(){this.connects=new jmUtils.list;var e=this.width(),t=this.height();this.center={x:e/2,y:t/2};var n;this.style.borderStyle?n=this.style.borderStyle:n={stroke:this.style.borderStroke||this.editor.defaultStyle.cellBorder.stroke,rectStroke:this.style.borderStroke||this.editor.defaultStyle.cellBorder.stroke,close:!0},this.rect=this.graph.createShape("resize",{width:e,height:t,movable:!1,resizable:this.resizable,style:n}),this.rect.visible=!1;var r=this.option.shape||this.style.shape;if(r){var i=jmUtils.extend({style:this.style,width:"94%",height:"94%",center:this.center,position:{x:"3%",y:"3%"}},this.option);this.shape=this.graph.createShape(r,i)}if(this.connectable){var s=8,o=this.graph.createRadialGradient(s/2,s/2,0,s/2,s/2,s);o.addStop(0,"#00FF00"),o.addStop(1,"#059505"),this.connArc=this.graph.createShape("arc",{center:{x:"50%",y:"50%"},width:s,height:s,radius:s,style:{fill:o,close:!0,zIndex:200}}),this.connArc.visible=!1,this.connectLine=this.graph.createShape("arrawline",{start:this.center,end:this.connArc.center(),offsetX:6,offsetY:12,style:this.editor.defaultStyle.dragLine}),this.connectLine.visible=!1,this.children.add(this.connectLine)}this.label=this.graph.createShape("label",{style:this.fontStyle,width:"100%",height:"100%",value:this.value()}),this.setStyle(this.styleName)},jmCell.prototype.add=function(){this.create(),this.children.add(this.rect),this.graph.children.add(this),this.editor.movable&&this.canMove(!0),this.shape&&this.children.add(this.shape),this.bind("mousedown",function(e){!e.ctrlKey&&!this.selected&&this.editor.selectAll(!1,this.id),this.selected||this.select(!0),e.cancel=!0}),this.bind("mouseup",function(e){var t=this.editor.connectFrom;t&&(t!=this&&t.connect(this)!==!1&&this.editor.save(),this.editor.connectFrom=null)}),this.connectable&&(this.bind("mousemove",function(){this.connArc.visible=!0,this.graph.refresh()}),this.bind("mouseleave",function(){this.editor.connectFrom!=this&&(this.connArc.visible=!1,this.graph.refresh())}),this.children.add(this.connArc),this.connArc.canMove(!0),this.connArc.on("movestart",function(t){var n=e;n.editor.connectFrom=n,n.connectLine.visible=!0}),this.connArc.on("moveend",function(t){var n=e,r=n.connArc.center();r.x="50%",r.y="50%",n.editor.connectFrom=null,n.connectLine.visible=!1,n.connArc.visible=!1,n.graph.refresh()})),this.on("move",function(e){this.initPosition()}),this.children.add(this.label),this.resize();var e=this;this.rect.on("resize",function(t,n,r,i){var s=e;s.position().x+=t,s.position().y+=n;var o=s.width()+r,u=s.height()+i;s.width(o),s.height(u),s.resize()})},jmCell.prototype.setOverlay=function(e,t,n,r){if(!this.overlay){this.overlay=document.createElement("img"),this.overlay.style.position="absolute";var i=this.getAbsoluteBounds(),s=i.bottom,o=i.right;this.style&&this.style.overlay&&this.style.overlay.margin&&(this.style.overlay.margin.left&&(o+=this.style.overlay.margin.left),this.style.overlay.margin.top&&(s+=this.style.overlay.margin.top)),this.overlay.style.top=s+"px",this.overlay.style.left=o+"px",this.overlay.style.border="0",this.editor.container.appendChild(this.overlay)}return e?(this.overlay.src=e,this.overlay.width=t,this.overlay.height=n,this.overlay.title=r):this.overlay.visible=!1,this.overlay},jmCell.prototype.resize=function(){var e=this.width(),t=this.height(),n=this.center;this.style.padding?(e=e-(this.style.padding.left||0)-(this.style.padding.right||0),t=t-(this.style.padding.top||0)-(this.style.padding.bottom||0),n.x=e/2+(this.style.padding.left||0),n.y=t/2+(this.style.padding.top||0)):(n.x=e/2,n.y=t/2),this.connArc&&(this.connArc.center().x=n.x,this.connArc.center().y=n.y),this.initPosition()},jmCell.prototype.initPosition=function(){var e=this.position();this.pos1||(this.pos1={}),this.pos1.x=e.x,this.pos1.y=e.y+this.height()/2,this.pos2||(this.pos2={}),this.pos2.x=e.x+this.width()/2,this.pos2.y=e.y,this.pos3||(this.pos3={}),this.pos3.x=e.x+this.width(),this.pos3.y=this.pos1.y,this.pos4||(this.pos4={}),this.pos4.x=this.pos2.x,this.pos4.y=e.y+this.height(),this.rect.width(this.width()),this.rect.height(this.height());if(this.overlay)if(this.overlay.tagName=="IMG"){var t=this.getAbsoluteBounds(),n=t.bottom,r=t.right;this.style&&this.style.overlay&&this.style.overlay.margin&&(this.style.overlay.margin.left&&(r+=this.style.overlay.margin.left),this.style.overlay.margin.top&&(n+=this.style.overlay.margin.top)),this.overlay.style.top=n+"px",this.overlay.style.left=r+"px"}else{var i=this.overlay.position();i.x=this.width(),i.y=this.height()}},jmCell.prototype.select=function(e,t){var n=!1;e===!1&&this.selected===!0?(this.rect.visible=!1,this.selected=!1,n=!0):e===!0&&!this.selected&&(this.selected=!0,this.rect.visible=!0,n=!0),n&&(this.graph.refresh(),t!==!1&&this.emit("select",this.selected))},jmCell.prototype.connect=function(e,t,n){var r=this.connects.get(function(t){return t.from==this&&t.to==e});if(!r){if(this.editor.validConnect&&!this.editor.validConnect(this,e))return!1;t=t||this.editor.maxId(),r=this.graph.createShape("cellConnectLine",{id:t,from:this,to:e,style:jmUtils.clone(this.style.connectLine),editor:this.editor}),this.connects.add(r),e.connects.add(r),r.value(n),this.graph.children.add(r),this.editor.connects.add(r),r.bind("mouseover",function(){if(!this.selected){var e=this.style&&this.style.overStroke?this.style.overStroke:jmEditorDefaultStyle.connectLine.overStroke;this.style.stroke=e,this.style.zIndex=2e3,this.graph.refresh()}}),r.bind("mouseleave",function(){if(!this.selected){var e=this.style&&this.style.normalStroke?this.style.normalStroke:jmEditorDefaultStyle.connectLine.stroke;this.style.stroke=e,this.style.zIndex=1,this.graph.refresh()}}),r.bind("mousedown",function(e){var t=this.selected;return!e.ctrlKey&&!this.selected&&this.editor.selectAll(!1,this.id),this.select(!t),!1})}},jmCell.prototype.value=function(e){return typeof e!="undefined"?(this.label&&(this.label.value=e),this.setValue("value",e)):this.getValue("value")},jmCell.prototype.center=function(e){return this.setValue("center",e)},jmCell.prototype.remove=function(e){if(e)return;this.editor&&(this.editor.cells.remove(this),this.graph.children.remove(this),this.overlay&&this.overlay.parentElement&&this.overlay.parentElement.removeChild(this.overlay)),this.connects.each(function(e,t){t.remove()},!0)},jmUtils.extend(jmConnectLine,jmPath),jmConnectLine.prototype.initPoints=function(){var e=this.from.pos4,t=this.to.pos2,n=this.to.position(),r=this.from.position();if(r.x+this.from.width()<n.x){e=this.from.pos3;var i=n.y-r.y-this.from.height();i>0?(i>30?e=this.from.pos4:e=this.from.pos3,t=this.to.pos2):r.y>n.y+this.to.height()?t=this.to.pos4:t=this.to.pos1}else if(r.x>n.x+this.to.width()){e=this.from.pos1;var i=n.y-r.y-this.from.height();i>0?(i>30?e=this.from.pos4:e=this.from.pos1,t=this.to.pos2):r.y>n.y+this.to.height()?t=this.to.pos4:t=this.to.pos3}else r.y>n.y+this.to.height()&&(e=this.from.pos1,t=this.to.pos1);return this.points=this.getPoints(e,t),this.points},jmConnectLine.prototype.getPoints=function(e,t){function n(e,t){return e.x==t.x?e.y>t.y?4:2:e.y==t.y?e.x>t.x?3:1:e.x>t.x?e.y>t.y?3412:3214:e.y>t.y?1432:1234}var r=30,i=30,s=[e];if(e==this.from.pos1)switch(t){case this.to.pos1:var o=Math.min(e.x-r,t.x-r),u={x:o,y:e.y};s.push(u);var a={x:o,y:t.y};s.push(a);break;case this.to.pos2:var u={x:t.x,y:e.y};s.push(u);break;case this.to.pos3:var u={x:(e.x-t.x)/2+t.x,y:e.y};s.push(u);var a={x:u.x,y:t.y};s.push(a);break;case this.to.pos4:var u={x:t.x,y:e.y};s.push(u)}else if(e==this.from.pos2)switch(t){case this.to.pos1:var u={x:e.x,y:t.y};s.push(u);break;case this.to.pos2:var u={x:e.x,y:Math.min(e.y-i,t.y-i)};s.push(u);break;case this.to.pos3:var u={x:e.x,y:t.y};s.push(u);break;case this.to.pos4:var u={x:e.x,y:(e.y-t.y)/2+t.y};s.push(u);var a={x:t.x,y:u.y};s.push(a)}else if(e==this.from.pos3)switch(t){case this.to.pos1:var u={x:(t.x-e.x)/2+e.x,y:e.y};s.push(u);var a={x:u.x,y:t.y};s.push(a);break;case this.to.pos2:var u={x:t.x,y:e.y};s.push(u);break;case this.to.pos3:var u={x:Math.max(e.x+r,t.x+r),y:e.y};s.push(u);var a={x:u.x,y:t.y};s.push(a);break;case this.to.pos4:var u={x:t.x,y:e.y};s.push(u)}else if(e==this.from.pos4)switch(t){case this.to.pos1:var u={x:e.x,y:t.y};s.push(u);break;case this.to.pos2:var u={x:e.x,y:Math.max((t.y-e.y)/2+e.y,t.y-i)};s.push(u);var a={x:t.x,y:u.y};s.push(a);break;case this.to.pos3:var u={x:e.x,y:t.y};s.push(u);break;case this.to.pos4:var u={x:e.x,y:Math.max(e.y+r,t.y+r)};s.push(u);var a={x:t.x,y:u.y};s.push(a)}s.push(t);var f=jmUtils.clone(s[s.length-2]),l=jmUtils.clone(t),c,h;for(var p in s){var d=s[p];c=Math.min(c||d.x,d.x),h=Math.min(h||d.y,d.y)}return f.x-=c,l.x-=c,f.y-=h,l.y-=h,this.arraw.start(f),this.arraw.end(l),this.arraw.style.stroke=this.arraw.style.fill=this.style.stroke,s},jmConnectLine.prototype.select=function(e){if(typeof e!="undefined"){var t=!1;e&&this.selected==0?(this.style.stroke=this.style&&this.style.selectedStroke?this.style.selectedStroke:this.editor.defaultStyle.connectLine.overStroke,this.style.zIndex=10,this.selected=!0,t=!0):this.selected==1&&(this.style.stroke=this.style&&this.style.normalStroke?this.style.normalStroke:this.editor.defaultStyle.connectLine.stroke,this.style.zIndex=1,this.selected=!1,t=!0),t&&(this.editor.emit("select",this,e),this.graph.refresh())}},jmConnectLine.prototype.value=function(e){return typeof e!="undefined"&&(this.label.value=e),this.label.value},jmConnectLine.prototype.remove=function(e){if(e)return;this.from&&this.from.connects.remove(this),this.to&&this.to.connects.remove(this),this.editor&&this.editor.connects.remove(this),this.graph.children.remove(this)},jmUtils.extend(jmEditor,jmProperty),jmEditor.prototype.defaultStyle={dragLine:{stroke:"rgb(59,111,41)",lineWidth:1,lineType:"dotted",dashLength:6,zIndex:1e4},cellBorder:{stroke:"rgb(0,255,0)"},connectLine:{stroke:"rgb(59,255,41)",overStroke:"red",lineWidth:2},font:{textAlign:"center",textBaseline:"middle",fill:"blue",font:"20px Arial",border:null},selectRect:{stroke:"rgb(0,255,0)",lineWidth:1,zIndex:1e4}},jmEditor.prototype.menus=function(){if(!this.menuBody){var e=this.menuBody={};this.menuBody.panel=document.createElement("div"),this.menuBody.panel.style.display="none",this.menuBody.panel.className="editor-menu",this.menuBody.container=document.createElement("ul"),this.menuBody.panel.appendChild(this.menuBody.container),document.body.appendChild(this.menuBody.panel),this.menuBody.show=function(e,t){this.panel.style.display="inline",this.panel.style.position="absolute";if(e&&t)this.panel.style.top=t+1+"px",this.panel.style.left=e+1+"px";else{var n=jmUtils.getEventPosition(event);this.panel.style.top=n.pageY+1+"px",this.panel.style.left=n.pageX+1+"px"}return this},this.menuBody.add=function(t,n){var r=document.createElement("li");return typeof t=="string"?r.innerHTML=t:r.appendChild(t),r.onclick=function(){n&&n.call(this),e.hide()},this.container.appendChild(r),this},this.menuBody.hide=function(){return this.panel.style.display="none",this},this.graph.bind("mousedown",function(t){e.hide()})}return this.menuBody.container.innerHTML="",this.menuBody},jmEditor.prototype.addCell=function(e){e=e||{},e.graph=this.graph,e.editor=this;if(!this.isEnabled()||this.option.resizable===!1)e.resizable=!1;var t=new jmCell(e);if(this.validCell&&!this.validCell(t))return;var n=this;return t.on("select",function(e){n.emit("select",this,e)}),t.on("move",function(e){var t=n;if(e.trans===!0){var r=t.getSelectedCells();for(var i=0;i<r.length;i++)r[i]!=this&&r[i].offset(e.offsetX,e.offsetY,!1)}t.resize(this)}),t.id=e.id||this.maxId(),this.cells.add(t),t.add(),this.resize(t),t},jmEditor.prototype.maxId=function(){var e=0;return this.cells.each(function(t,n){e=Math.max(n.id,e)}),this.connects.each(function(t,n){e=Math.max(n.id,e)}),e+1},jmEditor.prototype.isEnabled=function(e){return typeof e!="undefined"&&(this.__enabled=e),this.__enabled},jmEditor.prototype.initEvents=function(){var e=this;this.graph.bind("mousedown",function(t){var n=e;if(t.button==0||t.button==1)return n.selectAll(!1),n.selecting=!0,n.selectRect.position({x:t.position.offsetX,y:t.position.offsetY}),n.selectRect.width(1),n.selectRect.height(1),n.selectRect.visible=!0,!1}),this.graph.bind("mousemove",function(t){var n=e;if(n.selecting){var r=n.selectRect.position(),i=t.position.offsetX-r.x,s=t.position.offsetY-r.y;return n.selectRect.width(i),n.selectRect.height(s),n.graph.refresh(),!1}}),jmUtils.bindEvent(document,"mousemove",function(t){var n=e;if(n.currentComponent){t=t||event;var r=jmUtils.getEventPosition(t||event),i=r.pageX-n.currentComponent.evtX,s=r.pageY-n.currentComponent.evtY;return n.currentComponent.left+=i,n.currentComponent.top+=s,n.currentComponent.img.style.left=n.currentComponent.left+"px",n.currentComponent.img.style.top=n.currentComponent.top+"px",n.currentComponent.evtX=r.pageX,n.currentComponent.evtY=r.pageY,!1}}),jmUtils.bindEvent(document,"mouseup",function(t){var n=e;if(n.currentComponent){t=t||event;var r=jmUtils.getElementPosition(n.graph.canvas),i=jmUtils.getEventPosition(t);if(i.pageX>=r.left&&i.pageX<=r.left+n.graph.canvas.width&&i.pageY>=r.top&&i.pageY<=r.top+n.graph.canvas.height){var s=n.currentComponent.img.getAttribute("data-component"),o=n.components[s],u=i.pageX-r.left,a=i.pageY-r.top;o.width&&(u-=o.width/2),o.height&&(a-=o.height/2),typeof o=="function"?o.call(n,{x:u,y:a}):(o=jmUtils.clone(o),o.position={x:u,y:a},n.addCell(o)),n.save(),n.graph.refresh()}return document.body.removeChild(n.currentComponent.img),n.currentComponent=null,!1}if(n.selecting){n.selectRect.visible=!1,n.selecting=!1;var f=n.selectRect.position(),l={x:f.x+n.selectRect.width(),y:f.y+n.selectRect.height()};n.cells.each(function(e,t){var n=t.position?t.position():t.center?t.center():{x:0,y:0};n.x>=Math.min(f.x,l.x)&&n.x<=Math.max(f.x,l.x)&&n.y>=Math.min(f.y,l.y)&&n.y<=Math.max(f.y,l.y)&&t.select(!0)}),n.graph.refresh()}}),this.graph.bind("keydown",function(t){var n=t.keyCode,r=e;switch(n){case 46:if(r.isEnabled()){var i=!1,s=r.getSelectedCells();s&&s.length>0&&(r.remove(s),i=!0),r.connects.each(function(e,t){t.selected&&(t.remove(),i=!0)},!0);if(i)return r.graph.refresh(),r.save(),!1}break;case 97:case 65:if(t.ctrlKey)return r.selectAll(!0),r.emit("select",r,!0),!1;break;case 37:if(r.movable){var s=r.getSelectedCells();return r.moveCells(s,-1,0),!1}break;case 38:if(r.movable){var s=r.getSelectedCells();return r.moveCells(s,0,-1),!1}break;case 39:if(r.movable){var s=r.getSelectedCells();return r.moveCells(s,1,0),!1}break;case 40:if(r.movable){var s=r.getSelectedCells();return r.moveCells(s,0,1),!1}}})},jmEditor.prototype.selectAll=function(e,t){this.cells.each(function(n,r){if(t&&r.id==t)return;r.select(e)}),this.connects.each(function(t,n){n.select(e==1)})},jmEditor.prototype.getCell=function(e){return this.cells.get(function(t){return t.id==e})},jmEditor.prototype.getCells=function(){return this.cells.items},jmEditor.prototype.getSelectedCells=function(){var e=[];return this.cells.each(function(t,n){n.selected&&e.push(n)}),e},jmEditor.prototype.getSelectedConnects=function(){var e=[];return this.connects.each(function(t,n){n.selected&&e.push(n)}),e},jmEditor.prototype.moveCells=function(e,t,n){if(jmUtils.isArray(e))for(var r=e.length-1;r>=0;r--)e[r].offset(t,n);else e&&e.offset(t,n);this.graph.refresh()},jmEditor.prototype.remove=function(e){if(jmUtils.isArray(e))for(var t=e.length-1;t>=0;t--)e[t].remove();else e&&e.remove();this.graph.refresh()},jmEditor.prototype.clear=function(){this.remove(this.cells.items)},jmEditor.prototype.regComponent=function(e,t){this.components||(this.components=[]),this.components.push(t);if(typeof e=="string"){var n=document.createElement("img");n.src=e,e=n}e.setAttribute("data-component",this.components.length-1);var r=this;return jmUtils.bindEvent(e,"mousedown",function(e){var t=r;e=e||event;var n=e.target||e.srcElement,i=jmUtils.getElementPosition(n);n.getAttribute("data-component")||n.children.length==0&&(n=n.parentElement),t.currentComponent={},t.currentComponent.img=document.createElement("img"),t.currentComponent.img.setAttribute("data-component",n.getAttribute("data-component"));if(n.tagName!=="IMG")for(var s in n.children){var o=n.children[s];if(o.tagName==="IMG"){n=o;break}}t.currentComponent.img.src=n.src,t.currentComponent.img.width=n.width,t.currentComponent.img.height=n.height,t.currentComponent.img.style.position="absolute",t.currentComponent.left=i.left,t.currentComponent.top=i.top,t.currentComponent.img.style.left=i.left+"px",t.currentComponent.img.style.top=i.top+"px",window.document.body.appendChild(t.currentComponent.img);var u=jmUtils.getEventPosition(e||event);return t.currentComponent.evtX=u.pageX,t.currentComponent.evtY=u.pageY,e&&e.preventDefault?e.preventDefault():window.event.returnValue=!1,!1}),e},jmEditor.prototype.regStyle=function(e,t){this.styles[e]=t},jmEditor.prototype.save=function(){if(!this.isEnabled())return;this.caches||(this.caches=[]),this.cacheIndex<this.caches.length-1&&(this.caches=this.caches.slice(0,this.cacheIndex)),this.caches.length>10&&(this.caches=this.caches.slice(this.caches.length-10)),this.caches.push(this.toJSON()),this.cacheIndex=this.caches.length-1},jmEditor.prototype.undo=function(){if(!this.isEnabled())return;if(this.caches&&this.caches.length>0&&this.cacheIndex>0){typeof this.cacheIndex=="undefined"&&(this.cacheIndex=this.cacheIndex||this.caches.length-1),this.cacheIndex=this.cacheIndex>0?--this.cacheIndex:0;var e=this.caches[this.cacheIndex];this.fromJSON(e,!0)}},jmEditor.prototype.redo=function(){if(!this.isEnabled())return;if(this.cacheIndex!==undefined&&this.cacheIndex<this.caches.length-1&&this.caches&&this.caches.length>0){this.cacheIndex=this.cacheIndex+1;if(this.cacheIndex<this.caches.length){var e=this.caches[this.cacheIndex];this.fromJSON(e,!0)}}},jmEditor.prototype.align=function(e){var t=this.getSelectedCells();if(t.length<2)return;var n;for(var r in t){var i=t[r],s=i.position();if(!n||n.y>s.y)n=i}switch(e){case"left":for(var r in t){var i=t[r];e=="left"&&i.offset(n.position().x-i.position().x,0,!1)}break;case"right":for(var r in t){var i=t[r],o=n.position().x+n.width();i.offset(o-i.width()-i.position().x,0,!1)}break;case"center":for(var r in t){var i=t[r],u=n.position().y+n.height()/2;i.offset(0,u-i.height()/2-i.position().y,!1)}break;case"top":for(var r in t){var i=t[r];i.offset(0,n.position().y-i.position().y,!1)}break;case"bottom":for(var r in t){var i=t[r],a=n.position().y+n.height();i.offset(0,a-i.height()-i.position().y,!1)}break;case"middle":for(var r in t){var i=t[r],f=n.position().x+n.width()/2;i.offset(f-i.width()/2-i.position().x,0,!1)}}this.save(),this.graph.refresh()},jmEditor.prototype.resize=function(e){var t=0,n=0;if(e){var r=e.position();t=r.x+e.width(),n=r.y+e.height()}else this.cells.each(function(e,r){var i=r.position(),s=i.x+r.width(),o=i.y+r.height();t=Math.max(s,t),n=Math.max(o,n)});(t>this.graph.canvas.width||n>this.graph.canvas.height)&&this.graph.redraw(Math.max(t,this.graph.canvas.width)+10,Math.max(n,this.graph.canvas.height)+10)},jmEditor.prototype.execute=function(e){switch(e){case"zoomOut":this.graph.zoomOut();break;case"zoomIn":this.graph.zoomIn();break;case"zoomActual":this.graph.zoomActual();break;case"undo":this.undo();break;case"redo":this.redo()}},jmEditor.prototype.toImage=function(){return this.graph.toDataURL()},jmEditor.prototype.toJSON=function(){var e={cells:[],toString:function(){return JSON.stringify(this)}};return this.cells.each(function(t,n){var r={outs:[]};r.id=n.id,r.position=n.position(),r.width=n.width(),r.height=n.height(),r.style=n.styleName||n.style,r.value=n.value(),n.connects&&n.connects.each(function(e,t){t.from==n&&r.outs.push({id:t.id,to:t.to.id,value:t.value(),from:n.id})}),e.cells.push(r)}),e},jmEditor.prototype.fromJSON=function(e,t){if(!e)return;typeof e=="string"&&(e=JSON.parse(e)),this.clear();if(e.cells){for(var n in e.cells){var r=e.cells[n];this.addCell(r)}for(var n in e.cells){var r=e.cells[n];if(r.outs){var i=this.getCell(r.id);if(!i)continue;for(var s in r.outs){var o=r.outs[s];if(o.to){var u=this.getCell(o.to);u&&i.connect(u,o.id,o.value)}}}}this.resize(),this.graph.refresh()}t!==!0&&this.save()}