<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>故障预警</title>

<link rel="stylesheet"
	href="/BLHPumTurEvaDia/tool/easyui-1.4.5/themes/default/easyui.css">
<link rel="stylesheet" type="text/css"
	href="/BLHPumTurEvaDia/tool/easyui-1.4.5/themes/icon.css">
<link rel="stylesheet" type="text/css"
	href="/BLHPumTurEvaDia/css/assess/inputdiv.css">
<link rel="stylesheet" type="text/css"
	href="/BLHPumTurEvaDia/js/assess/icon.css">
<link rel="stylesheet" type="text/css"
	href="/BLHPumTurEvaDia/css/assess/assesment.css">
<link rel="stylesheet"
	href="/BLHPumTurEvaDia/tool/dataTable/jquery.dataTables.min.css">
<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/jquery/jquery.min.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/easyui-1.4.5/jquery.easyui.min.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/easyui-1.4.5/locale/easyui-lang-zh_CN.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/js/highcharts_util.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/dataTable/jquery.dataTables.min.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/js/assess/lodash.min.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/js/assess/easyui-util-all.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/js/highcharts_util.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/js/assess/highcharts.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/highcharts/highcharts-more.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/js/assess/sand-signika.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/js/warningChart/echarts.min.js"></script>
</head>
<script type="text/javascript">
	function myformatter(date) {
		var y = date.getFullYear();
		var m = date.getMonth() + 1;
		var d = date.getDate();
		return y + '-' + (m < 10 ? ('0' + m) : m) + '-'
				+ (d < 10 ? ('0' + d) : d);
	}
	function myparser(s) {
		if (!s)
			return new Date();
		var ss = (s.split('-'));
		var y = parseInt(ss[0], 10);
		var m = parseInt(ss[1], 10);
		var d = parseInt(ss[2], 10);
		if (!isNaN(y) && !isNaN(m) && !isNaN(d)) {
			return new Date(y, m - 1, d);
		} else {
			return new Date();
		}
	}
</script>
<script type="text/javascript">
	var table = $('#historyTable').DataTable();
	function faultWarning() {
		showMask();
		table.destroy();
		var system = $("#subSystem option:selected").val(); //把前端选择的子系统传给“system”
		var starTime = getComboboxValue("startTime");
		var endTime = getDate("endTime");
		var url1 = "/BLHPumTurEvaDia/faultwarning/fault-warning?inputStr="
				+ system + "//" + starTime + "//" + endTime; //将某个子系统历史数据的地址传给url1
		$.getJSON(url1, function(data) {
			var rows = data.historyTable;
			loadData('historyTable', rows);
		});
		hideMask();
	}

	//***上面的代码实现了历史数据的调出，下面的代码实现某一故障，鼠标点上去，以调出相应的图表Chart***//
	$(document)
			.ready(
					function() {
						$('#historyTable tbody').on('mouseover', 'tr', //mouseover：鼠标移上字体时。（jQuery 事件 - mouseout() 方法）
						function() {
							$(this).toggleClass('selected');
						});
						$('#historyTable tbody').on('mouseout', 'tr',
								function() {
									$(this).toggleClass('selected');
								});
						$('#historyTable tbody')
								.on(
										'click',
										'tr', //mouseout：当鼠标指针从元素上移开时，发生 mouseout 事件，改变元素的背景色 
										function() {
											var url = "/BLHPumTurEvaDia/datamine/history/view-parameter-curve?inputStr=";
											// $(this).toggleClass('selected');
											var data = table.row('.selected')
													.data(); //将前端点击的行的选择传给参数“data”
											var start = data.startTimeString; //将选中那行的元素--开始时间传给“start”
											var end = data.endTimeString; //将选中那行的元素--结束时间传给“end”
											var para = data.paramters; //将选中那行的元素--参数传给“para”
											console.log(para); //传递成功显示“para”
											var titleChart = para.split(" ");

											url = url + start + "//" + end
													+ "//" + para; //重新定义了传入地址url
											console.log(url);
											var chart1 = Highcharts.chart;

											$
													.getJSON(
															url,
															function(result) { //调用url地址json数据，加载成功执行回调函数result
																options1.series[0].data = result.data1.value;
																options1.series[0].name = titleChart[0];
																chart1 = new Highcharts.Chart(
																		options1);
																chart1.series[0]
																		.update(options1.series[0].data);
															});

											var options1 = {
												chart : {
													renderTo : 'container1', //生成的故障图1扔进“container1”里
													type : 'spline'
												},
												series : [ {} ],
												title : null,
												xAxis : {
													lineWidth : 2,
													lineColor : 'black',
													gridLineColor : '#A0A0A0',
													gridLineDashStyle : 'dash',
													minorGridLineWidth : 0,
													minorTickLength : 5,
													minorTickInterval : 'auto',
													minorTickPosition : 'outside',
													minorTickWidth : 1
												},
												yAxis : {
													title : {
														text : null
													},
													lineWidth : 2,
													lineColor : 'black',
													gridLineColor : '#A0A0A0',
													gridLineDashStyle : 'dash',
													minorGridLineWidth : 0,
													minorTickLength : 5,
													minorTickInterval : 'auto',
													minorTickPosition : 'outside',
													minorTickWidth : 1
												},
												credits : {
													enabled : false
												}
											};
										});
					});

	$(function() {
		$("#bt_warning").click(faultWarning);
	});
</script>

<body>
	<div class="input_div" style="margin-bottom: 5px;">
		<span class="input_title">条件输入：</span> <label
			style="margin-bottom: 5px">开始时间：</label><input id="startTime"
			class="easyui-datebox" required style="width: 150px; height: 26px">
		<label style="margin-bottom: 5px">结束时间：</label><input id="endTime"
			class="easyui-datebox" required style="width: 150px; height: 26px">
		<script>
			$.extend($.fn.validatebox.defaults.rules, {
				md : {
					validator : function(value, param) {
						var d1 = $.fn.datebox.defaults.parser(param[0]);
						var d2 = $.fn.datebox.defaults.parser(value);
						return d2 >= d1;
					},
					message : '结束时间必须大于或等于开始时间。'
				}
			})
		</script>
		<label for="model">系统选择：</label> <select id="subSystem"
			class="easyui-combobox" style="width: 120px;">
			<option value="Gov">球阀系统</option>
			<option value="Pum">发电机及励磁系统</option>
			<option value="ball">调速器系统</option>
			<option value="Exc">主变系统</option>
			<option value="Transfer">水泵水轮机</option>
		</select> <a id="bt_warning" href="#" class="easyui-linkbutton"
			data-options="iconCls:'icon-ok'">开始查询</a>
	</div>

	<div style="margin-left: 2%; margin-right: 2%; width: 96%">
		<table title="查询结果" class="easyui-datagrid"
			style="width: 37%; height: 490px"
			data-options="singleSelect:true,fitColumns:false,display:'inline-block',style:{marginRight:'20px',float:'left'}"
			id="historyTable">
			<thead>
				<tr>
					<th data-options="field:'faultID',align:'center',width:200">故障名称</th>
					<th data-options="field:'paramters',align:'center',width:250">关联参数</th>
				</tr>
			</thead>
		</table>
		<div class="easyui-panel" title="查询结果图"
			style="width: 55%; height: 490px">
			<div id="container1">
				<pre>    暂无结果</pre>
			</div>
		</div>
	</div>

	<div class="ipad" style="height: 25px"></div>

	<div style="margin-left: 2%; margin-right: 2%; width: 96%">
		<div class="easyui-panel" title="预警结果分析图"
			style="width: 94%; height: 450px">
			<div id="container3" style="width: 94%; height: 450px"></div>
		</div>

	</div>
	<script type="text/javascript">
		var dom = document.getElementById("container3");
		var myChart = echarts.init(dom);
		var app = {};
		option = null;
		var data = genData(50);

		option = {
			title : {
				text : '故障预警结果分析',
				subtext : '概率分布',
				x : 'center'
			},
			tooltip : {
				trigger : 'item',
				formatter : "{a} <br/>{b} : {c} ({d}%)"
			},
			legend : {
				type : 'scroll',
				orient : 'vertical',
				right : 10,
				top : 20,
				bottom : 20,
				data : data.legendData,

				selected : data.selected
			},
			series : [ {
				name : '故障类型',
				type : 'pie',
				radius : '55%',
				center : [ '40%', '50%' ],
				data : data.seriesData,
				itemStyle : {
					emphasis : {
						shadowBlur : 10,
						shadowOffsetX : 0,
						shadowColor : 'rgba(0, 0, 0, 0.5)'
					}
				}
			} ]
		};

		function genData(count) {
			var nameList = [ '赵', '钱', '孙', '李', '周', '吴', '郑', '王', '冯', '陈',
					'褚', '卫', '蒋', '沈', '韩', '杨', '朱', '秦', '尤', '许', '何', '吕',
					'施', '张', '孔', '曹', '严', '华', '金', '魏', '陶', '姜', '戚', '谢',
					'邹', '喻', '柏', '水', '窦', '章', '云', '苏', '潘', '葛', '奚', '范',
					'彭', '郎', '鲁', '韦', '昌', '马', '苗', '凤', '花', '方', '俞', '任',
					'袁', '柳', '酆', '鲍', '史', '唐', '费', '廉', '岑', '薛', '雷', '贺',
					'倪', '汤', '滕', '殷', '罗', '毕', '郝', '邬', '安', '常', '乐', '于',
					'时', '傅', '皮', '卞', '齐', '康', '伍', '余', '元', '卜', '顾', '孟',
					'平', '黄', '和', '穆', '萧', '尹', '姚', '邵', '湛', '汪', '祁', '毛',
					'禹', '狄', '米', '贝', '明', '臧', '计', '伏', '成', '戴', '谈', '宋',
					'茅', '庞', '熊', '纪', '舒', '屈', '项', '祝', '董', '梁', '杜', '阮',
					'蓝', '闵', '席', '季', '麻', '强', '贾', '路', '娄', '危' ];
			var legendData = [];
			var seriesData = [];
			var selected = {};
			for (var i = 0; i < 25; i++) {
				name = Math.random() > 0.65 ? makeWord(4, 1) + '·'
						+ makeWord(3, 0) : makeWord(2, 1);
				legendData.push(name);
				seriesData.push({
					name : name,
					value : Math.round(Math.random() * 100000)
				});
				selected[name] = i < 5;
			}

			return {
				legendData : legendData,
				seriesData : seriesData,
				selected : selected
			};

			function makeWord(max, min) {
				var nameLen = Math.ceil(Math.random() * max + min);
				var name = [];
				for (var i = 0; i < nameLen; i++) {
					name.push(nameList[Math.round(Math.random()
							* nameList.length - 1)]);
				}
				return name.join('');
			}
		};
		if (option && typeof option === "object") {
			myChart.setOption(option, true);
		}
	</script>



</body>
</html>