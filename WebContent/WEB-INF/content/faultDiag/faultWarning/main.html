<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>故障预警</title>
<link rel="stylesheet" type="text/css"
	href="/BLHPumTurEvaDia/css/assess/inputdiv.css">
<link rel="stylesheet" type="text/css"
	href="/BLHPumTurEvaDia/js/assess/icon.css">
<link rel="stylesheet" type="text/css"
	href="/BLHPumTurEvaDia/css/assess/assesment.css">
<link rel="stylesheet"
	href="/BLHPumTurEvaDia/tool/easyui-1.4.5/themes/default/easyui.css">
<link rel="stylesheet" type="text/css"
	href="/BLHPumTurEvaDia/tool/easyui-1.4.5/themes/icon.css">

<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/jquery/jquery.min.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/easyui-1.4.5/jquery.easyui.min.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/easyui-1.4.5/locale/easyui-lang-zh_CN.js"></script>


<script type="text/javascript"
	src="/BLHPumTurEvaDia/js/assess/lodash.min.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/js/assess/easyui-util-all.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/js/highcharts_util.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/js/assess/highcharts.js"></script>

<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/highcharts/highcharts-more.js"></script>

</head>
<script type="text/javascript">
	function faultWarning() {

		var system = $("#subSystem").combobox("getValue"); //把前端选择的子系统传给“system”

		var starTime = getComboboxValue("startTime");
		var endTime = getDate("endTime");
		var url = "/BLHPumTurEvaDia/faultwarning/fault-warning-result?inputStr="
				+ system + "//" + starTime + "//" + endTime; //将某个子系统历史数据的地址传给url1
		console.log(url);

		getJSON(url, function(result) {
			loadData("historyTable", result.bottomDetail);
		});
	}

	function WarningResult() {
		showMask();
		var starTime = getComboboxValue("startTime");
		/* var endTime = getDate("endTime"); */
		var url1 = "/BLHPumTurEvaDia/faultwarning/fault-warning?inputStr="
				+ starTime; //将某个子系统历史数据的地址传给url1
		console.log(url1);
		getJSON(url1, function(data) {
			var view = data.resultFinal;
			loadData("faultInfo", view.tableWarn);

			var jsonArr = [];
			tem_Arry = [];
			for (i = 0; i < view.pieWarn.length; i++) {
				jsonArr = [ view.pieWarn[i].faultName,
						view.pieWarn[i].faultChance ];
				tem_Arry.push(jsonArr)
			}
			var chart = {
				type : 'pie',
				options3d : {
					enabled : true,
					alpha : 45,
					beta : 0
				}

			};
			var credits = {
				enabled : false
			};

			var title = {
				text : '预警概率结果分析图'
			};
			var legend = {//控制图例显示位置
				layout : 'vertical',
				align : 'left',
				verticalAlign : 'top',
				borderWidth : 0
			};
			var tooltip = {
				pointFormat : '<b>{point.percentage:.1f}%</b>'
			};

			var plotOptions = {
				pie : {
					allowPointSelect : true,
					cursor : 'pointer',
					depth : 35,
					dataLabels : {
						enabled : true,
						format : '{point.name}'
					},
					showInLegend : true
				// 设置饼图是否在图例中显示
				}
			};

			var series = [ {
				type : 'pie',
				data : tem_Arry
			} ];

			var json = {};
			json.chart = chart;
			json.title = title;
			json.legend = legend;
			json.credits = credits;
			json.tooltip = tooltip;
			json.plotOptions = plotOptions;
			json.series = series;
			$('#container3').highcharts(json);
		});

	}

	$(function() {
		$("#StartFind").click(faultWarning);
		$("#Startwarning").click(WarningResult);
	});
</script>

<body>

	<div class="input_div"
		style="margin-bottom: 5px; margin-top: 5px; margin-left: 2%; margin-right: 2%; width: 96%">
		<span class="input_title">条件输入：</span> <label
			style="margin-bottom: 5px">开始时间：</label><input id="startTime"
			class="easyui-datebox" required style="width: 150px; height: 26px">
		<label style="margin-bottom: 5px">结束时间：</label><input id="endTime"
			class="easyui-datebox" required style="width: 150px; height: 26px">
		<script>
			$.extend($.fn.validatebox.defaults.rules, {
				md : {
					validator : function(value, param) {
						var d1 = $.fn.datebox.defaults.parser(param[0]);
						var d2 = $.fn.datebox.defaults.parser(value);
						return d2 >= d1;
					},
					message : '结束时间必须大于或等于开始时间。'
				}
			})
		</script>
		<label for="model">系统选择：</label> <select id="subSystem"
			class="easyui-combobox" style="width: 140px;">
			<option value="ball">球阀系统</option>
			<option value="Exc">发电机及励磁系统</option>
			<option value="Gov">调速器系统</option>
			<option value="Transfer">主变系统</option>
			<option value="Pum">水泵水轮机</option>
		</select> <a id="StartFind" href="#" class="easyui-linkbutton"
			data-options="iconCls:'icon-ok'">开始查询</a> <a id="Startwarning"
			href="#" class="easyui-linkbutton" data-options="iconCls:'icon-ok'">开始预警</a>
	</div>

	<!-- 第一个框 start -->

	<div
		style="width: 96%; height: auto; margin-left: 2%; margin-right: 2%; float: left; display: inline; margin-bottom: 10px">

		<table class="easyui-datagrid" id="historyTable" title="历史运行状态数据"
			data-options="singleSelect:true,fitColumns:false,display:'inline-block'"
			style="text-align: left; width: 100%; height: auto;">
			<thead>
				<tr>
					<th data-options="field:'system',align:'center'" style="width: 15%">故障名称</th>
					<th data-options="field:'startTimeString',align:'center'"
						style="width: 20%">开始时间</th>
					<th data-options="field:'endTimeString',align:'center'"
						style="width: 20%">结束时间</th>
					<th data-options="field:'paramters',align:'center'"
						style="width: 40%">关联参数</th>
				</tr>
			</thead>
		</table>
	</div>
	<!-- 第一个框 end -->

	

	<!-- 第二个框 start -->
	<div style="width: 96%; height: auto; margin-left: 2%; 
	   margin-right: 2%; float: left; display: inline; margin-bottom: 10px">
		<div class="easyui-panel" title="预警结果分析图"
			style="width: auto; height: auto">
			<div id="container3" style="width: 100%; height: 390px;"></div>
		</div>
	</div>
	<!-- 第二个框 end -->

	<!-- 第三个框 start -->
	<div style="width: 96%; height: auto; margin-left: 2%; margin-right: 2%; float: left; display: inline; margin-bottom: 10px">
			<table class="easyui-datagrid" title="评价与建议" id="faultInfo"
				style="width: 100%; height: 460px"
				data-options="singleSelect:true,fitColumns:false,display:'inline-block'">
				<thead>
					<tr>
						<th data-options="field:'system',align:'center'"
							style="width: 15%">系统名称</th>
						<th data-options="field:'faultName',align:'center'"
							style="width: 50%">故障名称</th>
						<th data-options="field:'detail',align:'center'"
							style="width: 25%">发生概率</th>
					</tr>
				</thead>
			</table>
		</div>
	<!-- 第三个框 end -->
</body>
</html>