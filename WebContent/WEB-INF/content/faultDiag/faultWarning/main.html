<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>故障预警</title>
<link rel="stylesheet" type="text/css"
	href="/BLHPumTurEvaDia/css/assess/inputdiv.css">
<link rel="stylesheet" type="text/css"
	href="/BLHPumTurEvaDia/js/assess/icon.css">
<link rel="stylesheet" type="text/css"
	href="/BLHPumTurEvaDia/css/assess/assesment.css">
<link rel="stylesheet"
	href="/BLHPumTurEvaDia/tool/easyui-1.4.5/themes/default/easyui.css">
<link rel="stylesheet" type="text/css"
	href="/BLHPumTurEvaDia/tool/easyui-1.4.5/themes/icon.css">

<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/jquery/jquery.min.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/easyui-1.4.5/jquery.easyui.min.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/easyui-1.4.5/locale/easyui-lang-zh_CN.js"></script>


<script type="text/javascript"
	src="/BLHPumTurEvaDia/js/assess/lodash.min.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/js/assess/easyui-util-all.js"></script>
<!-- <script type="text/javascript"
	src="/BLHPumTurEvaDia/js/highcharts_util.js"></script> -->
<script type="text/javascript"
	src="/BLHPumTurEvaDia/js/echarts.js"></script>
<!-- <script type="text/javascript"
	src="/BLHPumTurEvaDia/js/assess/highcharts.js"></script>

<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/highcharts/highcharts-more.js"></script> -->

</head>
<script type="text/javascript">
	function faultWarning() {

		var system = $("#subSystem").combobox("getValue"); //把前端选择的子系统传给“system”

		var starTime = getComboboxValue("startTime");
		var endTime = getDate("endTime");
		var url = "/BLHPumTurEvaDia/faultwarning/fault-warning-result?inputStr="
				+ system + "//" + starTime + "//" + endTime; //将某个子系统历史数据的地址传给url1
		console.log(url);

		getJSON(url, function(result) {
			loadData("historyTable", result.bottomDetail);
		});
	}

	var myChart;
	function WarningResult() {
		showMask(); 
		var starTime = getComboboxValue("startTime");
		var url1 = "/BLHPumTurEvaDia/faultwarning/fault-warning?inputStr="
				+ starTime +"//"+0; //将某个子系统历史数据的地址传给url1
		console.log(url1);
		getJSON(url1, function(data) {
			var view = data.resultFinal;
			loadData("faultInfo", view.tableWarn);
			
			tem_Arry = [];
			for (i = 0; i < view.pieWarn.length; i++) {
				var map={'value':view.pieWarn[i].faultChance,'name':view.pieWarn[i].faultName};
				tem_Arry.push(map)
			}
			
			if(myChart !=null && myChart !=""&& myChart !=undefined){
				myChart.dispose();
			}
			myChart = echarts.init(document.getElementById('container3'));
			
			 option = {
				        title : {
				            text: '故障预警分析图',
				            subtext: '',
				            x:'center'
				        },
				        tooltip : {
				            trigger: 'item',
				            formatter: "{a} <br/>{b} : {c} ({d}%)"
				        },
				        toolbox:{
				            show:true,
				            orient: 'horizontal',
				            showTitle: true,
				            feature:{
				                saveAsImage:{
				                    type:'png',
				                    show:true,
				                    title:'保存为图片'
				                },
				                restore:{show:true}
				            }
				        },
				        legend: {
				            orient: 'horizontal',
				            left: '5%',
				            top:'8%',
				            data: ['发电机及励磁系统','水泵水轮机','主变系统','调速器系统','球阀系统']
				        },
				        series : [
				            {
				                name: '预警结果',
				                type: 'pie',
				                radius : '35%',
				                center: ['15%', '50%'],
				                data:tem_Arry,

				                itemStyle: {
				                    emphasis: {
				                        shadowBlur: 10,
				                        shadowOffsetX: 0,
				                        shadowColor: 'rgba(0, 0, 0, 0.5)'
				                    }
				                }
				            },
				            {
				                name: '',
				                /* label: {
				                    normal: {
				                        formatter: '{a|{a}}{abg|}\n{hr|}\n  {b|{b}：}{c}  {per|{d}%}  ',
				                        backgroundColor: '#eee',
				                        borderColor: '#aaa',
				                        borderWidth: 1,
				                        borderRadius: 4,
				                        rich: {
				                            a: {
				                                color: '#999',
				                                lineHeight: 22,
				                                align: 'center'
				                            },
				                            hr: {
				                                borderColor: '#aaa',
				                                width: '100%',
				                                borderWidth: 0.5,
				                                height: 0
				                            },
				                            b: {
				                                fontSize: 15,
				                                lineHeight: 25
				                            },
				                            per: {
				                                color: '#eee',
				                                backgroundColor: '#334455',
				                                padding: [2, 4],
				                                borderRadius: 2
				                            }
				                        }
				                    }
				                }, */
				                type: 'pie',
				                radius: '20%',
				                center: ['65%', '50%'],
				                data: [ ]
				            }
				        ]
				    };
			
			    myChart.setOption(option);

			    myChart.on('click', function(params) {
			       /* var index=option.series[1].name;
			        alert(index);*/
					var system=params.name;
			        var url2="/BLHPumTurEvaDia/faultwarning/fault-warning?inputStr="
						+ starTime+"//"+system; //将某个子系统历史数据的地址传给url1
			        console.log(url2);
			        getJSON(url2, function(data) {
			        	
			        	var view = data.resultFinal;
						loadData("faultInfo", view.tableWarn);

						tem_Arry = [];
						for (i = 0; i < view.pieWarn.length; i++) {
							var map={'value':view.pieWarn[i].faultChance,'name':view.pieWarn[i].faultName};
							tem_Arry.push(map)
						}
			        	
				            option.series[1].name='预警结果';
				            option.series[1].data=tem_Arry;
				            myChart.setOption(option);
				        
			        });
			        
			        
			    });
			
		});

	}

	$(function() {
		$("#StartFind").click(faultWarning);
		$("#Startwarning").click(WarningResult);
	});
</script>

<body>

	<div class="input_div"
		style="margin-bottom: 5px; margin-top: 5px; margin-left: 2%; margin-right: 2%; width: 96%">
		<span class="input_title">条件输入：</span> <label
			style="margin-bottom: 5px">开始时间：</label><input id="startTime"
			class="easyui-datebox" required style="width: 150px; height: 26px">
		<label style="margin-bottom: 5px">结束时间：</label><input id="endTime"
			class="easyui-datebox" required style="width: 150px; height: 26px">
		<script>
			$.extend($.fn.validatebox.defaults.rules, {
				md : {
					validator : function(value, param) {
						var d1 = $.fn.datebox.defaults.parser(param[0]);
						var d2 = $.fn.datebox.defaults.parser(value);
						return d2 >= d1;
					},
					message : '结束时间必须大于或等于开始时间。'
				}
			})
		</script>
		<label for="model">系统选择：</label> <select id="subSystem"
			class="easyui-combobox" style="width: 140px;">
			<option value="ball">球阀系统</option>
			<option value="Exc">发电机及励磁系统</option>
			<option value="Gov">调速器系统</option>
			<option value="Transfer">主变系统</option>
			<option value="Pum">水泵水轮机</option>
		</select> <a id="StartFind" href="#" class="easyui-linkbutton"
			data-options="iconCls:'icon-ok'">开始查询</a> <a id="Startwarning"
			href="#" class="easyui-linkbutton" data-options="iconCls:'icon-ok'">开始预警</a>
	</div>

	<!-- 第一个框 start -->

	<div
		style="width: 96%; height: auto; margin-left: 2%; margin-right: 2%; float: left; display: inline; margin-bottom: 10px">

		<table class="easyui-datagrid" id="historyTable" title="历史运行状态数据"
			data-options="singleSelect:true,fitColumns:false,display:'inline-block'"
			style="text-align: left; width: 99%; height: auto;">
			<thead>
				<tr>
					<th data-options="field:'system',align:'center'" style="width: 15%">故障名称</th>
					<th data-options="field:'startTimeString',align:'center'"
						style="width: 20%">开始时间</th>
					<th data-options="field:'endTimeString',align:'center'"
						style="width: 20%">结束时间</th>
					<th data-options="field:'paramters',align:'center'"
						style="width: 40%">关联参数</th>
				</tr>
			</thead>
		</table>
	</div>
	<!-- 第一个框 end -->

	

	<!-- 第二个框 start -->
	<div style="width: 96%; height: auto; margin-left: 2%;margin-right: 2% 
	   margin-right: 2%; float: left; display: inline; margin-bottom: 10px">
		<div class="easyui-panel" title="预警结果分析图"
			style="width: 99%; height: auto">
			<div id="container3" style=" height: 420px;">
			<pre>    暂无结果</pre>
			</div>
			
		</div>
	</div>
	<!-- 第二个框 end -->

	<!-- 第三个框 start -->
	<div style="width: 96%; height: auto; margin-left: 2%; margin-right: 2%; float: left; display: inline; margin-bottom: 10px">
			<table class="easyui-datagrid" title="评价结果展示" id="faultInfo"
				style="width: 99%; height: auto"
				data-options="singleSelect:true,fitColumns:false,display:'inline-block'">
				<thead>
					<tr>
						
						<th data-options="field:'faultName',align:'center'"
							style="width: 50%">故障名称</th>
						<th data-options="field:'detail',align:'center'"
							style="width: 45%">发生概率</th>
					</tr>
				</thead>
			</table>
		</div>
	<!-- 第三个框 end -->
</body>
</html>