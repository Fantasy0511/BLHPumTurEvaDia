<head>
<meta charset="UTF-8">
<title>故障树</title>
<link rel="stylesheet"
	href="/BLHPumTurEvaDia/tool/bootstrap/dist/css/bootstrap.min.css">
<link rel="stylesheet"
	href="/BLHPumTurEvaDia/tool/dataTable/jquery.dataTables.min.css">
<link rel="stylesheet" type="text/css"
	href="/BLHPumTurEvaDia/tool/easyui-1.4.5/themes/default/easyui.css">
<link rel="stylesheet" type="text/css"
	href="/BLHPumTurEvaDia/tool/easyui-1.4.5/themes/icon.css">
<link rel="stylesheet" type="text/css"
	href="/BLHPumTurEvaDia/css/assess/inputdiv.css">
<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/easyui-1.5.2/jquery.min.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/bootstrap/dist/js/bootstrap.min.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/easyui-1.5.2/jquery.easyui.min.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/easyui-1.5.2/locale/easyui-lang-zh_CN.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/jmgraph/jmgraph.min.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/jmgraph/images.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/js/tree/editor_util.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/js/tree/pumTur.js"></script>
</head>
<script type="text/javascript">
	var id;
	$(function() {
		var tree = new TreeEditor({
			container : 'container',
			enabled : false,
			connectable : false,
			movable : false,
			resizable : false
		});
		tree.fromJSON(cell1);
		tree.graph.refresh();

		function changecolor1(result) {
			var graphJSON = tree.toJSON();
			var cells = graphJSON.cells;
			for (i in result) {
				for (j = 0; j < cell1.cells.length; j++) {
					if (cell1.cells[j].id == result[i]) {
						var stylename = cell1.cells[j].style;
						cells[j].style = stylename + '_selected';
					}
				}

			}
			tree.fromJSON(graphJSON);
		}

		function changecolor2(result) {
			var graphJSON = tree.toJSON();
			var cells = graphJSON.cells;
			for (i in result) {
				for (j = 0; j < cell2.cells.length; j++) {
					if (cell2.cells[j].id == result[i]) {
						var stylename = cell2.cells[j].style;
						cells[j].style = stylename + '_selected';
					}
				}
			}
			tree.fromJSON(graphJSON);
		}

		function changecolor3(result) {
			var graphJSON = tree.toJSON();
			var cells = graphJSON.cells;
			for (i in result) {
				for (j = 0; j < cell3.cells.length; j++) {
					if (cell3.cells[j].id == result[i]) {
						var stylename = cell3.cells[j].style;
						cells[j].style = stylename + '_selected';
					}
				}
			}
			tree.fromJSON(graphJSON);
		}

		function changecolor4(result) {
			var graphJSON = tree.toJSON();
			var cells = graphJSON.cells;
			for (i in result) {
				for (j = 0; j < cell4.cells.length; j++) {
					if (cell3.cells[j].id == result[i]) {
						var stylename = cell4.cells[j].style;
						cells[j].style = stylename + '_selected';
					}
				}
			}
			tree.fromJSON(graphJSON);
		}

		function changecolor5(result) {
			var graphJSON = tree.toJSON();
			var cells = graphJSON.cells;
			for (i in result) {
				for (j = 0; j < cell5.cells.length; j++) {
					if (cell3.cells[j].id == result[i]) {
						var stylename = cell5.cells[j].style;
						cells[j].style = stylename + '_selected';
					}
				}
			}
			tree.fromJSON(graphJSON);
		}
		$("#b1").click(function() {
			tree.fromJSON(cell1);
			changecolor1(id);
		});
		$("#b2").click(function() {
			tree.fromJSON(cell2);
			changecolor2(id);
		});
		$("#b3").click(function() {
			tree.fromJSON(cell3);
			changecolor3(id);
		});

		$("#b4").click(function() {
			tree.fromJSON(cell4);
			changecolor4(id);
		});

		$("#b5").click(function() {
			tree.fromJSON(cell5);
			changecolor5(id);
		});
		$("#b0").click(function() {
			diagnose();
			tree.fromJSON(cell1);
			changecolor1(id);
		});

	});

	function diagnose() {//从后台得到故障id
		showMask();
		var url = "/HPPumTurReg/faulttree/fault-tree";
		getJSON(url, function(data) {
			id = data.resultNode;
			loadData("faultInfo", data.faultInfo);
		});
	}
</script>

<style type="text/css">
.datagrid-header-row td {
	background-color: #ADF0A3;
	color: #fff
}
</style>
</head>
<body>
	
	<div class="input_div" style="margin-bottom: 5px; margin-top: 5px;">
		<span class="input_title">条件输入：</span> <label
			style="margin-bottom: 5px">开始时间：</label><input id="startTime"
			class="easyui-datebox" required style="width: 150px; height: 26px">
		<label style="margin-bottom: 5px">结束时间：</label><input id="endTime"
			class="easyui-datebox" required style="width: 150px; height: 26px">
		<script>
			$.extend($.fn.validatebox.defaults.rules, {
				md : {
					validator : function(value, param) {
						var d1 = $.fn.datebox.defaults.parser(param[0]);
						var d2 = $.fn.datebox.defaults.parser(value);
						return d2 >= d1;
					},
					message : '结束时间必须大于或等于开始时间。'
				}
			})
		</script>
		<a id="Startwarning" href="#" class="easyui-linkbutton"
			data-options="iconCls:'icon-ok'">开始诊断</a>
	</div>

	<div style="height: 10px"></div>

	<div style="width: auto">
		<div class="easyui-panel" title="诊断控制"></div>
		<div style="margin-top: 10px">
			<a style="margin-left: 10px">
				<button type="button" class="btn btn-primary" id="b1">水导装置</button>
			</a> <a style="margin-left: 20px">
				<button type="button" class="btn btn-primary" id="b2">过流部件</button>
			</a> <a style="margin-left: 20px">
				<button type="button" class="btn btn-primary" id="b3">轴系装置</button>
			</a> <a style="margin-left: 20px">
				<button type="button" class="btn btn-primary" id="b4">推力轴承装置</button>
			</a> <a style="margin-left: 20px">
				<button type="button" class="btn btn-primary" id="b5">水泵水轮机总图</button>
			</a> <a style="margin-left: 20px">
				<button type="button" class="btn btn-primary" id="b0">诊断</button>
			</a>
		</div>
	</div>



	<div style="height: 10px"></div>

	<div style="width: auto">
		<div>
			<div class="easyui-panel" title="故障树展示"></div>
			<div id="drag" title="故障树" style="width:1300px">
				<div style="cursor: pointer;">
					<span id="container" style="float: center"></span>
				</div>
			</div>
		</div>
	</div>

	<div style="width: auto">
		<table class="easyui-datagrid" id="faultInfo" title="诊断结果分析"
			style="height: 350px; word-break: break-all; word-wrap: break-all"
			data-options="rownumbers:true,fitColumns:false, singleSelect:true">
			<thead>
				<tr>
					<th data-options="field:'faultId',align:'center',width:300">故障名称</th>
					<th data-options="field:'faultRate',align:'center',width:300">发生概率</th>
					<th data-options="field:'suggesstion',align:'center',width:300">建议描述</th>
				</tr>
			</thead>
		</table>
	</div>

	<div style="height: 20px"></div>

</body>
</html>