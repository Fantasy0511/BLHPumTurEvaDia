<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>故障预警</title>
<link rel="stylesheet" type="text/css"
	href="/BLHPumTurEvaDia/css/assess/inputdiv.css">
<link rel="stylesheet" type="text/css"
	href="/BLHPumTurEvaDia/js/assess/icon.css">
<link rel="stylesheet" type="text/css"
	href="/BLHPumTurEvaDia/css/assess/assesment.css">
<link rel="stylesheet"
	href="/BLHPumTurEvaDia/tool/easyui-1.4.5/themes/default/easyui.css">
<link rel="stylesheet" type="text/css"
	href="/BLHPumTurEvaDia/tool/easyui-1.4.5/themes/icon.css">
<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/jquery/jquery.min.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/easyui-1.4.5/jquery.easyui.min.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/easyui-1.4.5/locale/easyui-lang-zh_CN.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/js/assess/highcharts.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/js/assess/lodash.min.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/js/assess/highcharts-more.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/js/assess/easyui-util-all.js"></script>

<script type="text/javascript"
	src="/BLHPumTurEvaDia/js/highcharts_util.js"></script>

</head>
<script type="text/javascript">
	function faultWarning() {
		
		var system = $("#subSystem").combobox("getValue"); //把前端选择的子系统传给“system”

		var starTime = getComboboxValue("startTime");
		var endTime = getDate("endTime");
		var url = "/BLHPumTurEvaDia/faultwarning/fault-warning-result?inputStr="
				+ system + "//" + starTime + "//" + endTime; //将某个子系统历史数据的地址传给url1
		console.log(url);

		getJSON(url, function(result) {
			loadData("historyTable", result.bottomDetail);
		});
	}

	function WarningResult() {
		showMask(); 
		var starTime = getComboboxValue("startTime");
		var url1 = "/BLHPumTurEvaDia/faultwarning/fault-warning?inputStr="
				+ starTime +"//"+0; //将某个子系统历史数据的地址传给url1
		console.log(url1);
		getJSON(url1, function(result) {
			/* loadData("historyTable", result.bottomDetail); */
			drawPic("container3", result.resultFinal.systemBar); // 画柱状图
			loadData("subfaultInfo", result.resultFinal.similarFault);
			loadData("faultInfo", result.resultFinal.parameterWarn);
		});
	}
	
	
	function historyFault(){
		$('#startTime').datebox('setValue', '2015-01-1');
		$('#endTime').datebox('setValue', '2018-01-01');
		$('#subSystem').combobox('setValue', 'Gov');
		var system = $("#subSystem").combobox("getValue"); //把前端选择的子系统传给“system”
		var starTime = getComboboxValue("startTime");
		var endTime = getDate("endTime");
		var url = "/BLHPumTurEvaDia/faultwarning/fault-warning-result?inputStr="
				+ system + "//" + starTime + "//" + endTime; //将某个子系统历史数据的地址传给url1
		console.log(url);

		getJSON(url, function(result) {
			loadData("historyTable", result.bottomDetail);
		});
	}

	$(function() {
		historyFault();
		$("#StartFind").click(faultWarning);
		$("#Startwarning").click(WarningResult);
	});
</script>

<body>

	<div class="input_div"
		style="margin-bottom: 5px; margin-top: 5px; margin-left: 2%; margin-right: 2%; width: 96%">
		<span class="input_title">条件输入：</span> <label
			style="margin-bottom: 5px">开始时间：</label><input id="startTime"
			class="easyui-datebox" required style="width: 150px; height: 26px">
		<label style="margin-bottom: 5px">结束时间：</label><input id="endTime"
			class="easyui-datebox" required style="width: 150px; height: 26px">
		<script>
			$.extend($.fn.validatebox.defaults.rules, {
				md : {
					validator : function(value, param) {
						var d1 = $.fn.datebox.defaults.parser(param[0]);
						var d2 = $.fn.datebox.defaults.parser(value);
						return d2 >= d1;
					},
					message : '结束时间必须大于或等于开始时间。'
				}
			})
		</script>
		<label for="model">系统选择：</label> <select id="subSystem"
			class="easyui-combobox" style="width: 140px;">
			<option value="ball">球阀系统</option>
			<option value="Exc">发电机及励磁系统</option>
			<option value="Gov">调速器系统</option>
			<option value="Transfer">主变系统</option>
			<option value="Pum">水泵水轮机</option>
		</select> <a id="StartFind" href="#" class="easyui-linkbutton"
			data-options="iconCls:'icon-ok'">开始查询</a> <a id="Startwarning"
			href="#" class="easyui-linkbutton" data-options="iconCls:'icon-ok'">开始预警</a>
	</div>

	<!-- 第一个框 start -->

	<div
		style="width: 96%; height: auto; margin-left: 2%; margin-right: 2%; float: left; display: inline; margin-bottom: 10px">

		<table class="easyui-datagrid" id="historyTable" title="历史运行状态数据"
			data-options="singleSelect:true,fitColumns:false,display:'inline-block'"
			style="text-align: left; width: 100%; height: auto;">
			<thead>
				<tr>
					<th data-options="field:'system',align:'center'" style="width: 15%">故障名称</th>
					<th data-options="field:'startTimeString',align:'center'"
						style="width: 20%">开始时间</th>
					<th data-options="field:'endTimeString',align:'center'"
						style="width: 20%">结束时间</th>
					<th data-options="field:'paramters',align:'left'"
						style="width: 46%">关联参数</th>
				</tr>
			</thead>
		</table>
	</div>
	<!-- 第一个框 end -->

	

	<!-- 第二个框 start -->
	<div style="width: 96%; height: auto; margin-left: 2%;margin-right: 2% 
	   margin-right: 2%; float: left; display: inline; margin-bottom: 10px">
		
		<div style="height:420px;width:49%;float:left">
			<div class="easyui-panel" title="子系统详细故障预警"
			style=" height: 400px">
			<div></div> <!-- 绘图区域自适应窗口 -->
			<div id="container3" style=" height:350px;width:95%;">
				<pre>暂无结果</pre> 
			</div>
			</div>
		</div>
		
		<div style="height:420px;width:49%;float:right">
			<table class="easyui-datagrid" title="故障参数" id="subfaultInfo"
				style="width: 100%; height: 400px"
				data-options="singleSelect:true,fitColumns:false,display:'inline-block',rownumbers:true">
				<thead>
					<tr>
						<th data-options="field:'faultName',align:'center'"
							style="width: 95%">故障参数</th>
					
					</tr>
				</thead>
			</table>
			</div>
	</div>
	<!-- 第二个框 end -->

	<!-- 第三个框 start -->
	<div style="width: 96%; height: auto; margin-left: 2%; margin-right: 2%; float: left; display: inline; margin-bottom: 10px">
			<table class="easyui-datagrid" title="历史相似故障" id="faultInfo"
				style="width: 100%; height: auto"
				data-options="singleSelect:true,fitColumns:false,display:'inline-block',rownumbers:true">
				<thead>
					<tr>
						<th data-options="field:'faultName',align:'center'"
							style="width: 48%">故障名称</th>
						<th data-options="field:'detail',align:'center',sortable:true"
							style="width: 49%">发生概率</th>
					</tr>
				</thead>
			</table>
		</div>
	<!-- 第三个框 end -->
</body>
</html>