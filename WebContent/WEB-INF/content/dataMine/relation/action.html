<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>关联分析</title>
<link rel="stylesheet"
	href="/BLHPumTurEvaDia/tool/bootstrap/dateTimePicker/bootstrap-datetimepicker.min.css">
<link rel="stylesheet"
	href="/BLHPumTurEvaDia/tool/bootstrap/dist/css/bootstrap.min.css">
<link rel="stylesheet"
	href="/BLHPumTurEvaDia/tool/dataTable/jquery.dataTables.min.css">
<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/jquery/jquery.min.js" charset="UTF-8"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/bootstrap/dist/js/bootstrap.min.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/bootstrap/dateTimePicker/bootstrap-datetimepicker.min.js"
	charset="UTF-8"></script>
<script type="text/javascript" src="/BLHPumTurEvaDia/js/echarts.js"></script>
<script type="text/javascript"
	src="/BLHPumTurEvaDia/tool/dataTable/jquery.dataTables.min.js"></script>
</head>
<style>
.page_operation_bar {
	height: 50px;
	width: 97%;
	margin: 10px;
	background-color: #d9edf7;
	border-radius: 15px 5px;
}

#showDiv {
	width: 100%;
	height: 7.2%;
	font-size: 16px;
	padding-top: 0.6%;
}

.form-group {
	
}
</style>
<script type="text/javascript">

</script>
<body>
	<div align="center">
		<div class="page_operation_bar">
			<div align="left" id="showDiv">
				<form action="" class="form-inline" role="form">
					<div class="col-sm-2 form-group" style="margin-right: -50px">
						<label class="control-label" for="unitNo"> 机组选择 &nbsp;</label>

						<div class="col-sm-4 input-group" id="unitNo">
							<select class="form-control">
								<option>1#</option>
								<option>2#</option>
								<option>3#</option>
								<option>4#</option>
							</select>
						</div>
					</div>
					<div class="col-sm-3 form-group" style="margin-right: -60px">
						<label for="dtp_input2" class="control-label">开始时间&nbsp;</label>

						<div class="input-group date form_date col-md-7" data-date=""
							data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
							<input style="background-color: #ffffff" placeholder="点击选择"
								class="form-control" size="16" type="text" value="" readonly>
							<span class="input-group-addon"><span
								class="glyphicon glyphicon-calendar"></span></span>
						</div>
						<input type="hidden" id="dtp_input1" value="" /><br />
					</div>
					<div class="col-sm-3 form-group" style="margin-right: -60px">
						<label for="dtp_input2" class="control-label">结束时间&nbsp;</label>

						<div class="input-group date form_date col-md-7" data-date=""
							data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
							<input style="background-color: #ffffff" placeholder="点击选择"
								class="form-control" size="16" type="text" value="" readonly>
							<span class="input-group-addon"><span
								class="glyphicon glyphicon-calendar"></span></span>
						</div>
						<input type="hidden" id="dtp_input2" value="" /><br />
					</div>
					<div class="col-sm-2 form-group" style="margin-right: -20px">
						<label class="control-label" for="method">方法选择 &nbsp;</label>

						<div class="col-sm-6 input-group" id="method">
							<select class="form-control">
								<option>Apriori</option>
								<option>FP-Growth</option>
							</select>
						</div>
					</div>
					<div class="col-sm-3 form-group" style="margin-right: -20px">
						<label class="control-label" for="method">子系统选择 &nbsp;</label>

						<div class="col-sm-6 input-group">
							<select class="form-control" id="subSystem">
								<option>ball</option>
								<option>Exc</option>
								<option>Gov</option>
								<option>Pum</option>
								<option>Transfer</option>
							</select>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>

	<div class="col-md-5">
		<div class="panel panel-default">
			<div class="panel-heading">
				<b><i class="glyphicon glyphicon glyphicon-edit">关联分析参数设置</i></b>
			</div>
			<div style="height: 230px">
				<div class="col-lg-8">
					<form class="form-horizontal">
						<div class="form-group"></div>
						<div class="form-group" style="margin-left: -80px">
							<div class="col-sm-1"></div>
							<label class="col-sm-4 control-label" for="minSupport">频繁项集数</label>

							<div class="col-sm-5 input-group">
								<input type='text' id='minSupport' class="form-control"
									placeholder="5"> <span class="input-group-addon">1</span>
							</div>
						</div>
						<div class="form-group" style="margin-left: -80px">
							<div class="col-sm-1"></div>
							<label class="col-sm-4 control-label" for="minConfidence">最小置信度</label>

							<div class="col-sm-5 input-group">
								<input type='text' id='minConfidence' class="form-control"
									placeholder="60"> <span class="input-group-addon">%</span>
							</div>
						</div>
					</form>
				</div>
				<div class="col-md-4" style="padding-top: 3%;">
					<span class="introduce">&nbsp;&nbsp;&nbsp;&nbsp;支持度是对频繁项出现次数的设置；置信度是对挖掘的关联关系的可信度的设置。</span>
				</div>
				<div class="col-lg-10">
					<div style="padding-top: 8%">
						<div class="col-md-4">
							<button type="button" class="btn btn-primary" id="btn_beginMine">开始挖掘</button>
						</div>
						<div class="col-md-5">
							<button type="button" class="btn btn-primary"
								id="btn_viewFrequent">查看频繁N项集</button>
						</div>
						<div class="col-md-3">
							<button type="button" class="btn btn-primary" ui-sref="">保存</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>


	<div class="col-md-7">
		<div class="panel panel-default">
			<div class="panel-heading">
				<b><i class="glyphicon glyphicon glyphicon-edit">频繁项集</i></b>
			</div>
			<div style="width: 95%; height: 230px;">
				<table class="table" id="historyTable">
					<thead>
						<tr>
							<th>频繁项集</th>
						</tr>
					</thead>
					<tbody></tbody>
				</table>
			</div>
		</div>
	</div>

	<div class="col-md-5">
		<div class="panel panel-default">
			<div class="panel-heading">
				<b><i class="glyphicon glyphicon glyphicon-edit">关联分析结果</i></b>
			</div>
			<div style="height: 550px">
				<table class="table" id="relationTable">
					<thead>
						<tr>
							<th>设备类型</th>
							<th>设备状态</th>
						</tr>
					</thead>
					<tbody></tbody>
				</table>
			</div>
		</div>
	</div>

	<div class="col-md-7">
		<div class="panel panel-default">
			<div class="panel-heading">
				<b><i class="glyphicon glyphicon glyphicon-edit">设备关联分析</i></b>
			</div>
			<div id="equipment" style="width: 95%; height: 550px;"></div>
		</div>
	</div>
	<script type="text/javascript">
    $('.form_date').datetimepicker({
        language: 'fr',
        weekStart: 1,
        todayBtn: 1,
        todayHighlight: 1,
        startView: 2,
        minView: 2,
        forceParse: 0,
        format: 'yyyy-mm-dd'
    });
</script>

	<!--解析数据
	<!--
var graph = {
    "nodes": [
        {

            "name": "",//名称
            "attributes": {},
            "id": "node1",//id
            "size": 40,//圆的大小
            "category": 1//类别
        }
    ],
    "links": [//连接
        {
            "source": "node1",//源点
            "target": "node2"//目标
        }
    ]
};
-->
	<script type="text/javascript">
	//开始挖掘方法
	var relationTable = $('#relationTable').DataTable();
	function beginDateMine(){
		relationTable.destroy();
		var minConfidence=$("#minConfidence").val();
		var minSupport =$("#minSupport").val();
		var subSystem=$("#subSystem option:selected").text();
		console.log(subSystem);
		console.log(minSupport);
		var urlAction="/BLHPumTurEvaDia/datamine/relation/relation";
		var url =urlAction+"?inputStr="+subSystem+"//"+minConfidence;
		console.log(url);
		$.getJSON(url,function(data){
			var graph=null;
			graph={"nodes":data.nodes,"links":data.links};
			var myChart = echarts.init(document.getElementById('equipment'));
			myChart.hideLoading();
			relationTable=$('#relationTable').DataTable({
				data:data.relationTables,
				columns:[
					{ "data": "deviceType" },
					{ "data": "deviceState" }
				]
			});
			var categories = [];
			var cats=["全场数据","1号机组","2号机组","3号机组","4号机组"]
			for (var i = 0; i < cats.length; i++) {
	    		categories[i] = {
	        	name: cats[i]
	    	};
		}
		graph.nodes.forEach(function (node) {
	    node.itemStyle = null;//
	    node.symbolSize = node.size;//强制指定节点的大小
	    // Use random x, y
	    node.x = node.y = null;
	    node.draggable = true;

	});
	option = {
	    title: {
	        text: '关联分析',//文本标题
	        subtext: 'Default layout',//副标题
	        top: 'bottom',//上下位置
	        left: 'right'//左右位置
	    },
	    tooltip: {
	        formatter: function (params, ticket, callback) {//回调函数
	            var str = appendPath(graph.nodes[params.dataIndex].id);
	            document.getElementById("div1").innerHTML = str;
	            return str;//
	        }
	    },
	    legend: [
	        {
	            // selectedMode: 'single',
	            data: categories.map(function (a) {//显示策略
	                return a.name;
	            })
	        }
	    ],
	    animation: false,//是否开启动画
	    series: [
	        {
	            name: '',
	            type: 'graph',
	            layout: 'force',
	            data: graph.nodes,//节点数据
	            links: graph.links,//节点边数据
	            categories: categories,//策略
	            roam: true,//是否开启滚轮缩放和拖拽漫游，默认为false（关闭），其他有效输入为true（开启），'scale'（仅开启滚轮缩放），'move'（仅开启拖拽漫游）
	            label: {
	                normal: {
	                    show: 'false',
	                    position: 'right'
	                }
	            },
	            slient: false,//是否响应点击事件，为false的时候就是响应
	            force: {
	                repulsion: 100
	            }
	        }
	    ]
	};

	myChart.setOption(option);
	/**
	 拼接路径
	 */
	function appendPath(id) {
	    var str = id;
	    var links = graph.links;
	    var i = 0;
	    var map = {};
	    for (i = 0; i < links.length; i++) {
	        map[links[i].target] = links[i].source;
	    }
	    while (true) {
	        if (map[id] == undefined) {
	            break;
	        }
	        str = map[id] + "->" + str;
	        id = map[id];
	    }
	    return str;
	}
	});
}
var table = $('#historyTable').DataTable();	
function viewFrequentItem(){
	table.destroy();
	var minSupport =$("#minSupport").val();
	var subSystem=$("#subSystem option:selected").text();
	console.log(subSystem);
	console.log(minSupport);
	var urlAction="/BLHPumTurEvaDia/datamine/relation/view-frequent";
	var url =urlAction+"?inputStr="+subSystem+"//"+minSupport;
	console.log(url);
	
	$.getJSON(url,function(data){
		var result=[];
		console.log(data.result);
		result[0]=[data.result]	;
		console.log(result);
		table=$('#historyTable').DataTable({
			data:result
		});
	});
	
}
$(function(){
	$("#btn_beginMine").click(beginDateMine);
	$("#btn_viewFrequent").click(viewFrequentItem);
});
</script>
</body>
</html>